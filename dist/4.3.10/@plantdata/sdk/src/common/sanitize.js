"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var $=require("jquery"),PdSanitizeUtil=function(){function t(e){void 0===e&&(e=t.SETTINGS.RELAXED),this.settings={},this.settings.elements=e.elements?e.elements:[],this.settings.attributes=e.attributes?e.attributes:{};var s=this.settings.attributes[t.ALL];this.settings.attributes[t.ALL]=s?s:[],this.settings.allow_comments=!!e.allow_comments&&e.allow_comments,this.allowed_elements={},this.settings.protocols=e.protocols?e.protocols:{},this.settings.add_attributes=e.add_attributes?e.add_attributes:{},this.dom=e.dom?e.dom:document;for(var i=0;i<this.settings.elements.length;i++)this.allowed_elements[this.settings.elements[i]]=!0;if(this.settings.remove_element_contents={},this.settings.remove_all_contents=!1,e.remove_contents)if(e.remove_contents instanceof Array)for(var i=0;i<e.remove_contents.length;i++)this.settings.remove_element_contents[e.remove_contents[i]]=!0;else this.settings.remove_all_contents=!0;this.transformers=e.transformers?e.transformers:[]}return t.prototype.cleanElement=function(e){function s(t,e){for(var s=0;s<e.length;s++)if(e[s]===t)return s;return-1}function i(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var s=[],i={},n=0;n<arguments.length;n++)if(arguments[n]&&arguments[n].length)for(var o=0;o<arguments[n].length;o++)i[arguments[n][o]]||(i[arguments[n][o]]=!0,s.push(arguments[n][o]));return s}function n(t){var e;switch(t.nodeType){case 1:o.call(this,t);break;case 3:case 5:e=t.cloneNode(!1),this.current_element.appendChild(e);break;case 8:this.settings.allow_comments&&(e=t.cloneNode(!1),this.current_element.appendChild(e));break;default:console.log("unknown node type",t.nodeType)}}function o(e){var o,l,a,h,d,c,m,u,_,p=r.call(this,e);if(e=p.node,l=e.nodeName.toLowerCase(),o=this.current_element,this.allowed_elements[l]||p.whitelist){this.current_element=this.dom.createElement(e.nodeName),o.appendChild(this.current_element);var f=this.settings.attributes;a=i(f[l],f[t.ALL],p.attr_whitelist);for(var g=0;g<a.length;g++)d=a[g],h=e.attributes[d],h&&(_=!0,this.settings.protocols[l]&&this.settings.protocols[l][d]&&(m=this.settings.protocols[l][d],u=h.value.toLowerCase().match(t.REGEX_PROTOCOL),_=u?s(u[1],m)!==-1:s(t.RELATIVE,m)!==-1),_&&(c=document.createAttribute(d),c.value=h.value,this.current_element.setAttributeNode(c)));if(this.settings.add_attributes[l])for(d in this.settings.add_attributes[l])this.settings.add_attributes[l].hasOwnProperty(d)&&(c=document.createAttribute(d),c.value=this.settings.add_attributes[l][d],this.current_element.setAttributeNode(c))}else if(s(e,this.whitelist_nodes)!==-1){for(this.current_element=e.cloneNode(!0);this.current_element.childNodes.length>0;)this.current_element.removeChild(this.current_element.firstChild);o.appendChild(this.current_element)}if(!this.settings.remove_all_contents&&!this.settings.remove_element_contents[l])for(var g=0;g<e.childNodes.length;g++)n.call(this,e.childNodes[g]);this.current_element.normalize&&this.current_element.normalize(),this.current_element=o}function r(t){for(var e,n={attr_whitelist:[],node:t,whitelist:!1},o=0;o<this.transformers.length;o++)if(e=this.transformers[o]({allowed_elements:this.allowed_elements,settings:this.settings,node:t,node_name:t.nodeName.toLowerCase(),whitelist_nodes:this.whitelist_nodes,dom:this.dom}),null!=e){if("object"!=typeof e)throw new Error("transformer output must be an object or null");if(e.whitelist_nodes&&e.whitelist_nodes instanceof Array)for(var r=0;r<e.whitelist_nodes.length;r++)s(e.whitelist_nodes[r],this.whitelist_nodes)===-1&&this.whitelist_nodes.push(e.whitelist_nodes[r]);n.whitelist=e.whitelist,e.attr_whitelist&&(n.attr_whitelist=i(n.attr_whitelist,e.attr_whitelist)),n.node=e.node?e.node:n.node}return n}var l=this.dom.createDocumentFragment();this.current_element=l,this.whitelist_nodes=[];for(var a=0;a<e.childNodes.length;a++)n.call(this,e.childNodes[a]);return l.normalize&&l.normalize(),l},t.prototype.cleanHTML=function(t){var e=$("<div>"+t+"</div>")[0],s=document.createElement("div");return s.appendChild(this.cleanElement(e)),s.innerHTML},t.RELATIVE="__RELATIVE__",t.ALL="__ALL__",t.SETTINGS={BASIC:{elements:["a","b","blockquote","br","cite","code","dd","dl","dt","em","i","li","ol","p","pre","q","small","strike","strong","sub","sup","u","ul"],attributes:{a:["href"],blockquote:["cite"],q:["cite"]},add_attributes:{a:{rel:"nofollow"}},protocols:{a:{href:["ftp","http","https","mailto",t.RELATIVE]},blockquote:{cite:["http","https",t.RELATIVE]},q:{cite:["http","https",t.RELATIVE]}}},RELAXED:{elements:["a","b","blockquote","br","caption","cite","code","col","colgroup","dd","dl","dt","em","h1","h2","h3","h4","h5","h6","i","img","li","ol","p","pre","q","small","strike","strong","sub","sup","table","tbody","td","tfoot","th","thead","tr","u","ul"],attributes:{a:["href","title"],blockquote:["cite"],col:["span","width"],colgroup:["span","width"],img:["align","alt","height","src","title","width"],ol:["start","type"],q:["cite"],table:["summary","width"],td:["abbr","axis","colspan","rowspan","width"],th:["abbr","axis","colspan","rowspan","scope","width"],ul:["type"]},protocols:{a:{href:["ftp","http","https","mailto",t.RELATIVE]},blockquote:{cite:["http","https",t.RELATIVE]},img:{src:["http","https",t.RELATIVE]},q:{cite:["http","https",t.RELATIVE]}}},RESTRICTED:{elements:["b","em","i","strong","u"]}},t.REGEX_PROTOCOL=/^([A-Za-z0-9\+\-\.\&\;\*\s]*?)(?:\:|&*0*58|&*x0*3a)/i,t}();exports.PdSanitizeUtil=PdSanitizeUtil;