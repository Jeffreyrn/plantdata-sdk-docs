"use strict";var __extends=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(exports,"__esModule",{value:!0});var $=require("jquery"),timing_1=require("../timing"),path_1=require("../plugins/model/path"),lodash_1=require("lodash"),common_1=require("../../../common/common"),filter_1=require("../plugins/filter/filter"),PdSDKPathTiming=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.defaultType="pathtiming",e}return __extends(e,t),e.prototype.buildFilter=function(e){var i=t.prototype.buildFilter.call(this,[{key:"distance",label:"设定分析步长",selected:3,options:[3,4,5,6],customEnable:!0,index:0}]);return filter_1.PdSDKPluginFilter.mergeFilterSettings(i,e)},e.prototype.buildLoaderParams=function(e){var i=t.prototype.buildLoaderParams.call(this,e);e.$type="pathtiming";var n=this.settings.loaderSettings.ajaxSettings,s=$.extend({kgName:this.settings.loaderSettings.kgName},n.queryData),r=$.extend({isInherit:!this.settings.showAllSchemaOptions,isShortest:!0},n.formData);if(r.start=e.start.id,r.end=e.end.id,this.filter){var o=this.filter.getFilterOptions();$.extend(r,o)}var a={queryData:s,formData:r,url:n.url||n.baseUrl+"network/path/timing"};return $.extend(!0,i,a)},e.prototype.destroyPlugins=function(){t.prototype.destroyPlugins.call(this),this.path&&this.path.destroy()},e.prototype.graphInitSuccess=function(t){if(this.initFilterOptions(t.config),t=t.entities,t&&t.length&&t.length>1){var e=common_1.PdCommonUtils.createId("path-timing-"),i=this.transferNode2Param(t[0]),n=this.transferNode2Param(t[1]);this.load({id:e,start:i,end:n},"init-path-timing")}},e.prototype.initPlugins=function(){var e=this;this.settings.advancedPrompt=$.extend(!0,{},{settings:{max:2,positiveBtn:{onclick:function(t){var i=t.getTagData();i&&2===i.length?(e.load({id:"",start:{id:i[0].id},end:{id:i[1].id}},"user-path-timing"),t.closeDialog()):common_1.PdCommonUtils.error("路径需要两个节点")}}}},this.settings.advancedPrompt);var i=this.settings;if(i.event.settings.active=!1,i.event.settings.titleType="short",i.path&&i.path.enable){var n={promptSettings:{schema:this.schema,promptSettings:this.settings.promptSettings}},s=this.createSDKPluginSettings(i.path,n);this.path=new path_1.PdSDKPluginPath(s)}t.prototype.initPlugins.call(this)},e.prototype.initSettings=function(i){return $.extend(!0,{},t.prototype.initSettings.call(this,e.defaultSettings),i)},e.prototype.updateFixedNodes=function(){var t=this.netChart,e=t.loadParams,i=t.data;if(e)if("dblClick"===e.$source)this.updateGraphLoadParams();else if(i.nodes&&i.nodes.length){t.fixedNodes=[];var n=void 0;e.start&&(n=e.start.id?"id":"name",e.start=lodash_1.find(i.nodes,[n,e.start[n].toString()])||i.nodes[0],t.fixedNodes.push(e.start)),e.end&&(n=e.end.id?"id":"name",e.end=lodash_1.find(i.nodes,[n,e.end[n].toString()])||i.nodes[1],t.fixedNodes.push(e.end)),t.fixedNodes=lodash_1.compact(t.fixedNodes)}},e.defaultSettings={path:{enable:!0,settings:{active:!0}},contextmenu:{enable:!0,settings:{menu:{"sub-graph":{enable:!1},"node-focus-to":{enable:!1}}}},filter:{settings:{editItemSettings:[{key:"hyponymyDistance",disabled:!0}]}}},e}(timing_1.PdSDKTiming);exports.PdSDKPathTiming=PdSDKPathTiming;