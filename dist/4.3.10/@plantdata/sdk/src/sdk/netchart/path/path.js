"use strict";var __extends=this&&this.__extends||function(){var t=function(e,s){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s])})(e,s)};return function(e,s){function n(){this.constructor=e}t(e,s),e.prototype=null===s?Object.create(s):(n.prototype=s.prototype,new n)}}();Object.defineProperty(exports,"__esModule",{value:!0});var $=require("jquery"),lodash_1=require("lodash"),netchart_1=require("../netchart"),connects_1=require("../plugins/connects/connects"),stats_1=require("../plugins/stats/stats"),path_1=require("../plugins/model/path"),common_1=require("../../../common/common"),filter_1=require("../plugins/filter/filter"),PdSDKPath=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.defaultType="path",e}return __extends(e,t),e.prototype.buildFilter=function(e){var s=t.prototype.buildFilter.call(this,[{key:"distance",label:"设定分析步长",selected:3,options:[3,4,5,6],customEnable:!0,index:0}]);return filter_1.PdSDKPluginFilter.mergeFilterSettings(s,e)},e.prototype.buildLoaderParams=function(e){var s=t.prototype.buildLoaderParams.call(this,e);if("dblClick"===e.$source){var n=t.prototype.buildGraphLoaderParams.call(this,e);return $.extend(!0,s,n)}e.$type="path";var i=this.settings.loaderSettings.ajaxSettings,a=$.extend({kgName:this.settings.loaderSettings.kgName},i.queryData),r=$.extend({isInherit:!this.settings.showAllSchemaOptions,isShortest:!0},i.formData);if(r.start=e.start.id,r.end=e.end.id,r.connectsCompute=this.settings.connects.enable!==!1,r.statsCompute=this.settings.stats.enable!==!1,this.filter){var o=this.filter.getFilterOptions();$.extend(r,o)}this.stats&&(r.statsConfig=this.stats.getStatsConfig());var d={queryData:a,formData:r,url:i.url||i.baseUrl+"network/path"};return $.extend(!0,s,d)},e.prototype.destroyPlugins=function(){t.prototype.destroyPlugins.call(this),this.stats&&this.stats.destroy(),this.connects&&this.connects.destroy(),this.path&&this.path.destroy()},e.prototype.graphInitSuccess=function(e){if(t.prototype.graphInitSuccess.call(this,e),e=e.entities,e&&e.length&&e.length>1){var s=common_1.PdCommonUtils.createId("path-"),n=this.transferNode2Param(e[0]),i=this.transferNode2Param(e[1]);this.load({id:s,start:n,end:i},"init-path")}},e.prototype.initNetChart=function(){t.prototype.initNetChart.call(this),this.netChart.$el.addClass("pdsdk-path")},e.prototype.initPlugins=function(){var e=this;this.settings.advancedPrompt=$.extend(!0,{},{settings:{max:2,positiveBtn:{onclick:function(t){var s=t.getTagData();s&&2===s.length?(e.load({id:"",start:{id:s[0].id},end:{id:s[1].id}},"user-path"),t.closeDialog()):common_1.PdCommonUtils.error("路径需要两个节点")}}}},this.settings.advancedPrompt),t.prototype.initPlugins.call(this);var s=this.settings;if(s.path&&s.path.enable){var n={promptSettings:{schema:this.schema,promptSettings:this.settings.promptSettings}},i=this.createSDKPluginSettings(s.path,n);this.path=new path_1.PdSDKPluginPath(i)}if(s.stats&&s.stats.enable){var n={schema:this.schema},i=this.createSDKPluginSettings(s.stats,n);this.stats=new stats_1.PdSDKPluginStats(i)}if(s.connects&&s.connects.enable){var i=this.createSDKPluginSettings(s.connects);this.connects=new connects_1.PdSDKPluginConnects(i)}},e.prototype.initSettings=function(s){return $.extend(!0,{},t.prototype.initSettings.call(this,e.defaultSettings),s)},e.prototype.updateFixedNodes=function(){var t=this.netChart,e=t.loadParams,s=t.data;if(e)if("dblClick"===e.$source)this.updateGraphLoadParams();else if(s.nodes&&s.nodes.length){t.fixedNodes=[];var n=void 0;e.start&&(n=e.start.id?"id":"name",e.start=lodash_1.find(s.nodes,[n,e.start[n].toString()])||s.nodes[0],t.fixedNodes.push(e.start)),e.end&&(n=e.end.id?"id":"name",e.end=lodash_1.find(s.nodes,[n,e.end[n].toString()])||s.nodes[1],t.fixedNodes.push(e.end)),t.fixedNodes=lodash_1.compact(t.fixedNodes)}},e.defaultSettings={stats:{enable:!0},connects:{enable:!0,settings:{mode:"click"}},path:{enable:!0,settings:{active:!0}},netChartSettings:{leftPanel:{active:!0,mode:"fixed"}},contextmenu:{enable:!0,settings:{menu:{"sub-graph":{enable:!1},"node-focus-to":{enable:!1}}}},filter:{settings:{editItemSettings:[{key:"hyponymyDistance",disabled:!0}]}}},e}(netchart_1.PdSDKNetChart);exports.PdSDKPath=PdSDKPath;