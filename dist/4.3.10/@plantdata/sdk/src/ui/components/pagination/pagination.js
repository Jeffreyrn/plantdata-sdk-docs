"use strict";var __extends=this&&this.__extends||function(){var t=function(e,a){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(e,a)};return function(e,a){function r(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(r.prototype=a.prototype,new r)}}();Object.defineProperty(exports,"__esModule",{value:!0});var $=require("jquery"),prefix_1=require("../prefix"),common_1=require("../../../common/common"),component_1=require("../../../core/component"),elecreator_1=require("../../../core/elecreator"),input_1=require("../input/input"),PdUIPagination=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.bindEvent=function(){var a=this;t.prototype.bindEvent.call(this),this.$el.off(),this.$el.on("click","li:not(.disabled)["+e.attrPage+"]",{eventData:this.settings.data},function(t){var r=t.data.eventData,s=$(t.currentTarget).attr(e.attrPage);a.settings.callback(t,parseInt(s,10),r)}),this.$el.on("click","li."+e.clsJumpName+" button",{eventData:this.settings.data},function(t){var e=t.data.eventData,r=$(t.currentTarget).prev("input").val();a.goTo(t,r,e)}),this.$el.on("keyup","li."+e.clsJumpName+" input",{eventData:this.settings.data},function(t){var e=$(t.currentTarget).val(),r=/^[0-9]*$/;if(""!==e)if(r.test(e+""))e>a.settings.total?$(t.currentTarget).val(a.settings.total):e<1&&$(t.currentTarget).val(1);else{var s=$(t.currentTarget).data("data");$(t.currentTarget).val(s)}}),this.$el.on("keydown","li."+e.clsJumpName+" input",{eventData:this.settings.data},function(t){var e=t.keyCode||t.which||t.charCode,r=$(t.currentTarget).val();if(13===e){var s=t.data.eventData;a.goTo(t,r,s)}else $(t.currentTarget).data("data",r)})},e.prototype.createPageHTML=function(){var t,a,r,s,l,i,o,n=this.settings.total,c=Math.floor(this.settings.current),m="";if(0===n)m="";else if(n<c)m="",common_1.PdCommonUtils.logger("error","当前页数不能大于总页数");else{var u=this.settings.showNum,p=(this.settings.showNum-1)/2,g=1,d=n,h=this.settings.prevNext,f=this.settings.prevNextMulti,N=this.settings.startEnd,v=this.settings.jump,P=this.settings.totalItemShow;d>u&&(c-p>1&&(g=Math.ceil(c-p)),d-c<p?g=d-u+1:d=g+u-1);var _=1!==c,E=_?"":"disabled",y=c!==n,$=y?"":"disabled";P&&(m+=elecreator_1.PdEleCreator.createEle("li",{cls:e.clsTotalName,html:"共计"+this.settings.totalItem+"个"})),N&&(m+=elecreator_1.PdEleCreator.createEle("li",{cls:e.clsItemName+" "+e.clsFirstName+" "+E,atts:(t={},t[e.attrPage]=1,t.title="首页",t)})),f&&(m+=elecreator_1.PdEleCreator.createEle("li",{cls:e.clsItemName+" "+e.clsPrevMultiName+" "+E,atts:(a={},a[e.attrPage]=c-u<1?1:c-u,a.title="往前翻"+u+"页",a)})),h&&(m+=elecreator_1.PdEleCreator.createEle("li",{cls:e.clsItemName+" "+e.clsPrevName+" "+E,atts:(r={},r[e.attrPage]=c-1<1?1:c-1,r.title="上一页",r)}));for(var C=g;C<=d;C++)m+=elecreator_1.PdEleCreator.createEle("li",{cls:e.clsItemName+" "+(C===c?"active":""),atts:(s={},s[e.attrPage]=C,s),html:C});if(h&&(m+=elecreator_1.PdEleCreator.createEle("li",{cls:e.clsItemName+" "+e.clsNextName+" "+$,atts:(l={},l[e.attrPage]=c+1>n?n:c+1,l.title="下一页",l)})),f&&(m+=elecreator_1.PdEleCreator.createEle("li",{cls:e.clsItemName+" "+e.clsNextMultiName+" "+$,atts:(i={},i[e.attrPage]=c+u>n?n:c+u,i.title="往后翻"+u+"页",i)})),N&&(m+=elecreator_1.PdEleCreator.createEle("li",{cls:e.clsItemName+" "+e.clsLastName+" "+$,atts:(o={},o[e.attrPage]=n,o.title="末页",o)})),v){var x=elecreator_1.PdEleCreator.createEle("span",{html:"跳转到"}),I=input_1.PdUIInput.create({atts:{type:"number",min:1,max:n,step:1,value:c}}),b=elecreator_1.PdEleCreator.createEle("span",{html:"页"});m+=elecreator_1.PdEleCreator.createEle("li",{cls:e.clsJumpName,html:x+I+b})}}return m},e.prototype.goTo=function(t,e,a){e<=this.settings.total&&e>0?this.settings.callback(t,e,a):common_1.PdCommonUtils.logger("error","跳转页不存在")},e.prototype.initSettings=function(a){return $.extend(!0,{},t.prototype.initSettings.call(this,e.defaultSettings),a)},e.prototype.initTemplate=function(){var t=$(this.settings.selector);if(this.saveOriginClass(t),this.settings.total||(this.settings.totalItem&&this.settings.pageSize?this.settings.total=Math.ceil(this.settings.totalItem/this.settings.pageSize):common_1.PdCommonUtils.logger("error","total或totalItem与pageSize不能同时为空")),this.settings.selector){if(t.is("ul"))t.hasClass(e.clsName)||t.addClass(e.clsName);else{var a=elecreator_1.PdEleCreator.createEle("ul",{cls:e.clsName});t.html(a),t=t.find(e.cls)}t.addClass(this.settings.cls);var r=this.createPageHTML();t.html(r)}else common_1.PdCommonUtils.logger("error","selector不能为空");return t},e.prototype.mounted=function(){t.prototype.mounted.call(this),this.bindEvent()},e.prototype.unbindEvent=function(){t.prototype.unbindEvent.call(this),this.$el.off(),this.$el.off("click","li:not(.disabled)["+e.attrPage+"]"),this.$el.off("click","li."+e.clsJumpName+" button"),this.$el.off("keyup","li."+e.clsJumpName+" input"),this.$el.off("keydown","li."+e.clsJumpName+" input")},e.defaultSettings={callback:$.noop,current:1,jump:!1,prevNext:!1,prevNextMulti:!1,selector:"",showNum:9,startEnd:!0,totalItemShow:!1},e.attrPage=prefix_1["default"].attr+"page",e.clsName=prefix_1["default"].cls+"pagination",e.cls="."+e.clsName,e.clsFirstName=e.clsName+"-first",e.clsItemName=e.clsName+"-item",e.clsJumpName=e.clsName+"-jump",e.clsLastName=e.clsName+"-last",e.clsNextName=e.clsName+"-next",e.clsNextMultiName=e.clsName+"-next-multi",e.clsPrevName=e.clsName+"-prev",e.clsPrevMultiName=e.clsName+"-prev-multi",e.clsTotalName=e.clsName+"-total",e}(component_1.PdComponent);exports.PdUIPagination=PdUIPagination;