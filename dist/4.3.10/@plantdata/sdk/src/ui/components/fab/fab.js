"use strict";var __extends=this&&this.__extends||function(){var t=function(e,s){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s])})(e,s)};return function(e,s){function n(){this.constructor=e}t(e,s),e.prototype=null===s?Object.create(s):(n.prototype=s.prototype,new n)}}();Object.defineProperty(exports,"__esModule",{value:!0});var $=require("jquery"),prefix_1=require("../prefix"),component_1=require("../../../core/component"),elecreator_1=require("../../../core/elecreator"),add_1=require("../../../icon/add"),PdUIFab=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.orderBy=function(t,e,s){void 0===s&&(s="asc");for(var n={},i=0;i<t.length;i++)for(var a=0;a<t.length;a++){var o=e(t[i]),r=e(t[a]);("asc"===s?o<r:o>r)&&(n=t[a],t[a]=t[i],t[i]=n)}return t},e.prototype.run=function(){this.toggleItemsPosition(!0),this.isOpen=!this.isOpen,this.$el.toggleClass("active",this.isOpen)},e.prototype.bindEvent=function(){var e=this;if(t.prototype.bindEvent.call(this),this.$mainButton.on("click",function(){e.run()}),this.settings.mainBtnSettings.events)for(var s in this.settings.mainBtnSettings.events)this.settings.mainBtnSettings.events.hasOwnProperty(s)&&this.$mainButton.on(s,this.settings.mainBtnSettings.events[s])},e.prototype.calcAutoPosition=function(){for(var t=this.$itemButtons.length,s=0,n=0,i=this.settings.mainRadiusDistance,a=i,o={},r=0;n<t;){var l=this.calcMax(a),c=this.settings.angleRange/360*2*Math.PI*a;r+=c,o[s]={level:s,R:a,num:l,l:c,min:c/l},n+=l,s++,a=i+s*this.settings.subRadiusDistance}for(var f=r/(t-s),g=0,h=[],u=0;u<s;u++){var p=o[u].l/f+1,m=Math.floor(p);o[u].newNum=m,o[u].gaps=o[u].l-(m-1)*f,h.push(o[u]),g+=m}var d=t-g;if(d){h=e.orderBy(h,function(t){return t.gaps},"desc");for(var v=[],y=0;y<h.length;y++)v.push(h[y].level);for(var _=0;d>0;){var P=o[v[_%v.length]];P.newNum=P.newNum+1,d--,_++}}return o},e.prototype.calcFixedPosition=function(t){for(var e=this.$itemButtons.length,s=0,n=0,i={};n<e;)i[s]={newNum:t},n+=t,s++;return i},e.prototype.calcMax=function(t){var e=10,s=360===this.settings.angleRange?0:1;return Math.floor(this.settings.angleRange/(180*Math.asin(e/t)/Math.PI*4)+s)},e.prototype.created=function(){t.prototype.created.call(this),this.isOpen=!1},e.prototype.initSettings=function(s){return $.extend(!0,{},t.prototype.initSettings.call(this,e.defaultSettings),s)},e.prototype.initTemplate=function(){var t=$(this.settings.selector);this.saveOriginClass(t);var s={};this.settings.ripple&&(s[prefix_1["default"].attr+"ripple"]=this.settings.ripple);var n=$(elecreator_1.PdEleCreator.createEle("button",{cls:e.clsMainName,html:this.settings.mainBtnSettings.html,atts:s})),i=elecreator_1.PdEleCreator.createEle("div",{cls:e.clsItemsName});t.addClass(e.clsName).html(elecreator_1.PdEleCreator.createEle("div",{cls:e.clsName,html:i})).find(e.cls).prepend(n),this.settings.mainBtnSettings.style&&n.css(this.settings.mainBtnSettings.style);for(var a=0,o=this.settings.subBtnSettings;a<o.length;a++){var r=o[a],l=$(elecreator_1.PdEleCreator.createEle("button",{cls:e.clsItemName,html:r.html,atts:s}));if(r.events)for(var c in r.events)r.events.hasOwnProperty(c)&&l.on(c,r.events[c]);if(r.data)for(var f in r.data)r.data.hasOwnProperty(f)&&l.data(f,r.data[f]);r.style&&l.css(r.style),t.find("."+e.clsItemsName).append(l)}return t},e.prototype.mounted=function(){t.prototype.mounted.call(this),this.$mainButton=this.select("."+e.clsMainName),this.$itemButtons=this.select("."+e.clsItemName),this.bindEvent(),this.settings.isOpened&&(this.toggleItemsPosition(!1),this.isOpen=!0,this.$el.toggleClass("active",this.isOpen))},e.prototype.toggleItemsPosition=function(t){var e=this,s=this,n={};n=this.settings.levelMax?this.calcFixedPosition(this.settings.levelMax):this.calcAutoPosition();var i=360===this.settings.angleRange?0:1,a=this.settings.mainRadiusDistance,o=0,r=0,l=n[o].newNum,c=this.$itemButtons.length;this.$itemButtons.each(function(f,g){var h=f-r,u=a+o*e.settings.subRadiusDistance,p=(c>l?l:c)-r,m=p-i===0?1:p-i,d=-u*Math.cos(Math.PI/180*(e.settings.angleRange/m*h+e.settings.startAngle)),v=-u*Math.sin(Math.PI/180*(e.settings.angleRange/m*h+e.settings.startAngle));if(e.isOpen){var y=e.settings.diff,_=e.settings.diff;if(t){var P=e.settings.offset*d+e.settings.diff,B=e.settings.offset*v+e.settings.diff,N=e.settings.inTime+(c-f)*e.settings.inIncr;$(g).animate({left:P,top:B},N,function(){$(this).animate({left:y,top:_},s.settings.offsetTime)})}else $(g).css({left:y,top:_})}else{var I=d+e.settings.diff,b=v+e.settings.diff;if(t){var P=e.settings.offset*d+e.settings.diff,B=e.settings.offset*v+e.settings.diff,N=e.settings.outTime+f*e.settings.outIncr;$(g).animate({left:P,top:B},N,function(){$(this).animate({left:I,top:b},s.settings.offsetTime)})}else $(g).css({left:I,top:b})}f>=l-1&&n[o+1]&&(r=l,o++,l+=n[o].newNum)})},e.prototype.unbindEvent=function(){if(t.prototype.unbindEvent.call(this),this.$mainButton.off("click"),this.settings.mainBtnSettings.events)for(var e in this.settings.mainBtnSettings.events)this.settings.mainBtnSettings.events.hasOwnProperty(e)&&this.$mainButton.off(e)},e.defaultSettings={isOpened:!1,startAngle:0,angleRange:90,diff:8,mainRadiusDistance:100,subRadiusDistance:60,offset:1.4,outTime:80,outIncr:50,offsetTime:200,inTime:160,inIncr:80,mainBtnSettings:{html:add_1["default"](24)},subBtnSettings:[]},e.clsName=prefix_1["default"].cls+"fab",e.cls="."+e.clsName,e.clsItemsName=e.clsName+"-items",e.clsItemName=e.clsName+"-item",e.clsMainName=e.clsName+"-main",e}(component_1.PdComponent);exports.PdUIFab=PdUIFab;