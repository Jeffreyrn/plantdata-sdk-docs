"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var $=require("jquery"),prefix_1=require("../prefix"),spin_1=require("../spin/spin"),elecreator_1=require("../../../core/elecreator"),PdUIAjax=function(){function e(){}return e.beforeSend=function(e,r){},e.complete=function(e,r){},e.dataFilter=function(e,r){return e},e.error=function(e,r,t){},e.getSendData=function(r){var t="",n={};if("string"==typeof r.data&&(t=decodeURIComponent(r.data)),t&&$.extend(n,e.unParam(t)),t="url="+r.url,t.indexOf("?")>-1){var i=t.substring(0,t.indexOf("?"));t=t.substring(t.indexOf("?")+1),$.extend(n,e.unParam(i),e.unParam(t))}return n},e.loader=function(r){var t=$.extend({},e.defaultSettings,r),n=r.el,i=t.data;if(i&&i instanceof Object)if(t.contentType&&"application/x-www-form-urlencoded"!==t.contentType)"application/json"===t.contentType&&(i=JSON.stringify(i));else for(var o in i)i.hasOwnProperty(o)&&"object"==typeof i[o]&&(i[o]=JSON.stringify(i[o]));return t.data=i,t.beforeSend=function(t,i){return e.beforeSend(t,i)!==!1&&(e.toggleLoadingStatus(n,!0),r.beforeSend?r.beforeSend(t,i):void 0)},t.dataFilter=function(t,n){return t=e.dataFilter(t,n),r.dataFilter&&(t=r.dataFilter(t,n)),t},t.error=[e.error],r.error&&("function"==typeof r.error?t.error.push(r.error):r.error instanceof Array&&(t.error=t.error.concat(r.error))),t.complete=[function(){e.toggleLoadingStatus(n,!1)},e.complete],r.complete&&("function"==typeof r.complete?t.complete.push(r.complete):r.complete instanceof Array&&(t.complete=t.complete.concat(r.complete))),t.success=[e.success],r.success&&("function"==typeof r.success?t.success.push(r.success):r.success instanceof Array&&(t.success=t.success.concat(r.success))),$.support&&t.crossDomain!==$.support.cors&&($.support.cors=t.crossDomain),new Promise(function(e,r){$.ajax(t).then(function(r,t,n){e({data:r,textStatus:t,jqXHR:n})},function(e,t,n){r({jqXHR:e,textStatus:t,errorThrown:n})})})},e.success=function(e,r,t){},e.unParam=function(r){var t={};return r.split("&").forEach(function(r){if(r.indexOf("[")>0&&r.indexOf("[")<r.indexOf("=")){var n=r.substring(0,r.indexOf("=")),i=r.substring(0,r.indexOf("[")),o=r.substring(r.indexOf("=")+1);e.dealParam(n,i,o,t)}else{var a=r.split("=");t[a[0]]=a[1]}}),t},e.dealParam=function(r,t,n,i){var o=r.substring(r.indexOf("[")+1,r.indexOf("]")),a=r.substring(r.indexOf("]")+1);o&&!$.isNumeric(o)?Array.isArray(i)?(i.length<=t&&i.push({}),t=o,i=i[t]):(i[t]||(i[t]={}),t=o,i=i[t]):(i[t]||(i[t]=[]),t=o,i=i[t]),0===a.indexOf("[")?e.dealParam(a,t,n,i):o&&!$.isNumeric(o)?i[o]=n:o?i[o]=n:i.push(n)},e.gentLoadingItem=function(r){var t="lg",n="div";r.is("A")||r.is("BUTTON")?t="xs":r.is("UL")&&(n="li");var i=spin_1.PdUISpin.create({size:t});return elecreator_1.PdEleCreator.createEle(n,{cls:e.clsLoadingName,html:i})},e.toggleLoadingStatus=function(r,t){if(r){var n=$(r);(n.is("INPUT")||n.is("BUTTON"))&&n.prop("disabled",t),t?n.append(e.gentLoadingItem(n)):n.find("."+e.clsLoadingName).remove()}},e.defaultSettings={ifModified:!0,crossDomain:!0,cache:!1},e.clsLoadingName=prefix_1["default"].cls+"ajax-loading",e}();exports.PdUIAjax=PdUIAjax;