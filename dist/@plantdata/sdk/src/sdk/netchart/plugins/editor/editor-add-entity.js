"use strict";var __extends=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();Object.defineProperty(exports,"__esModule",{value:!0});var $=require("jquery"),common_1=require("../../../../common/common"),editor_tool_1=require("./editor-tool"),form_1=require("../../../../ui/components/form/form"),message_1=require("../../../../ui/components/message/message"),prompt_1=require("../../../prompt/prompt"),edit_item_1=require("../../../../vis/utils/edit-item/edit-item"),PdSDKEditorAddEntity=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.destroy=function(){this.prompt.destroy(),t.prototype.destroy.call(this)},e.prototype.updateStatusBySelection=function(t,e,i){},e.prototype.createEditDialogSettings=function(){for(var t=this,e="",i=this.editFormSettingsGet(),r=0,o=i;r<o.length;r++){var n=o[r];e+=edit_item_1.PdVisEditItem.gentEditItem(n)}return{cls:"pdsdk-editor-entity-edit-dialog pdsdk-editor-common-dialog",title:this.settings.title,body:e,buttons:[{settings:{type:"primary",size:"sm",cls:"pdvis-modal-add-more",html:"继续添加"},events:{click:function(e){if(t.validate(i)){var r=form_1.PdUIForm.getFormData(t.editDialog.$el);r.parentId=t.data.id;for(var o=r.name.split(","),n=r.meaningTag?r.meaningTag.split(","):[],a=function(e){if(o[e]){var i={meaningTag:n[e]||"",name:o[e],parent:r.parent,parentId:r.parentId};t.addEntity(i).then(function(e){return t.afterAddEntity(i,e),i.name="",i.meaningTag="",form_1.PdUIForm.setFormData(t.editDialog.$el,i),Promise.resolve(r)})}},s=0;s<o.length;s++)a(s);return Promise.resolve(r)}return Promise.reject(new Error("请将表单填写完整"))}}}],positiveClick:function(){if(t.validate(i)){var e=form_1.PdUIForm.getFormData(t.editDialog.$el);e.parentId=t.data.id;for(var r=e.name.split(","),o=e.meaningTag?e.meaningTag.split(","):[],n=function(i){if(r[i]){var n={meaningTag:o[i]||"",name:r[i],parent:e.parent,parentId:e.parentId};t.addEntity(n).then(function(e){return t.afterAddEntity(n,e),Promise.resolve(n)})}},a=0;a<r.length;a++)n(a);return Promise.resolve(e)}return Promise.reject(new Error("请将表单填写完整"))}}},e.prototype.mounted=function(){var e=this;t.prototype.mounted.call(this),this.isWhole=!0,this.settings.promptSettings=$.extend(!0,{},{ajaxSettings:this.settings.ajaxSettings,selector:this.editDialog.$el.find(".pdsdk-editor-entity-prompt"),schema:this.settings.schema,autocompleteSettings:{onSearch:function(t){e.data=t,e.updateValidateStatus("parent",!!e.data)},onSearchTextChange:function(){e.data=null,e.updateValidateStatus("parent",!!e.data)}}},this.settings.promptSettings),this.prompt=new prompt_1.PdSDKPrompt(this.settings.promptSettings),this.bindValidateEvent(this.editFormSettingsGet())},e.prototype.onClick=function(t){this.data||this.isWhole||common_1.PdCommonUtils.error("未找到父概念"),this.showEdit({parent:this.data?this.data.name:""},t)},e.prototype.validate=function(e){var i=!0;return this.editDialog&&(i=t.prototype.validate.call(this,e),this.updateValidateStatus("parent",!!this.data),this.data||(message_1.PdUIMessage.error("所属概念不能为空"),i=!1)),i},e.defaultPromptSettings={promptType:"100",autocompleteSettings:{size:"sm",theme:"normal",name:"parent"}},e}(editor_tool_1.PdSDKEditorTool);exports.PdSDKEditorAddEntity=PdSDKEditorAddEntity;