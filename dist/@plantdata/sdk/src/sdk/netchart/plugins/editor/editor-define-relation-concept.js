"use strict";var __extends=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function a(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(a.prototype=i.prototype,new a)}}();Object.defineProperty(exports,"__esModule",{value:!0});var $=require("jquery"),lodash_1=require("lodash"),utils_1=require("../../../utils/utils"),editor_define_relation_1=require("./editor-define-relation"),format_list_bulleted_1=require("../../../../icon/format-list-bulleted"),PdSDKEditorDefineRelationConcept=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.openAddDialog=function(t){this.attributeListData=[],this.data=t,this.addDialog.open()},e.prototype.updateStatusBySelection=function(t,e,i){if(1===t.length&&0===e.length){var a=t[0];1===a.type?(this.updateStatus(!1),this.updateVisibility(!1)):0===a.type&&(this.data=a,this.updateStatus("0"!==a.id.toString()),this.updateVisibility(!0))}else this.updateStatus(!1),this.updateVisibility(!1)},e.prototype.addAttribute=function(t){var e=this.settings.ajaxSettings,i=e.queryData||{},a=e.formData||{};i.kgName=this.settings.kgName;var s=t;s.domain=this.data.id,s.type=this.settings.attributeType,a.attDefJson=JSON.stringify(s);var n={url:e.baseUrl+"attribute/addOrUpdate/definition",type:"POST",data:a};return n=$.extend(!0,{},n,e,this.settings.addAttributeSettings),n.url=utils_1.PdSDKUtils.buildUrl(n.url,i),utils_1.PdSDKUtils.ajax(n)},e.prototype.deleteAttribute=function(t){var e=this.settings.ajaxSettings,i=e.queryData||{},a=e.formData||{};i.kgName=this.settings.kgName,a.id=t;var s={url:e.baseUrl+"attribute/delete/definition",type:"POST",data:a};return s=$.extend(!0,{},s,e,this.settings.deleteAttributeSettings),s.url=utils_1.PdSDKUtils.buildUrl(s.url,i),utils_1.PdSDKUtils.ajax(s)},e.prototype.getAttributeList=function(){var t=this.settings.ajaxSettings,e=t.queryData||{};e.kgName=this.settings.kgName,e.id=this.data.id,e.type="0";var i={url:t.baseUrl+"attribute/get/definition",type:"GET"};return i=$.extend(!0,{},i,t,this.settings.attributeListSettings),i.url=utils_1.PdSDKUtils.buildUrl(i.url,e),utils_1.PdSDKUtils.ajax(i)},e.prototype.updateAttribute=function(t){var e=this.settings.ajaxSettings,i=e.queryData||{},a=e.formData||{};i.kgName=this.settings.kgName;var s=t;s.type=this.settings.attributeType,a.attDefJson=JSON.stringify(s);var n={url:e.baseUrl+"attribute/addOrUpdate/definition",type:"POST",data:a};return n=$.extend(!0,{},n,e,this.settings.updateAttributeSettings),n.url=utils_1.PdSDKUtils.buildUrl(n.url,i),utils_1.PdSDKUtils.ajax(n)},e.prototype.updateSchemaFun=function(t,e,i){var a=this.settings.schema,s={k:parseInt(t,10),v:e.name,dataType:0,domain:this.data.id.toString(),range:lodash_1.map(i,"id"),type:1};a.atts.push(s),this.dispatch("updateAtts",{attr:s}),this.settings.sdkNetChart.updateSchema(a)},e.prototype.getEditFormSettings=function(){return[{type:"custom",key:"domain",label:"定义域",mode:"label",html:'<div class="pdsdk-editor-define-attribute-modify-domain-select"></div>'},{type:"input",key:"name",label:"名称",mode:"label",required:!0},{type:"custom",key:"range",label:"值域",mode:"label",html:'<div class="pdsdk-editor-define-relation-prompt"></div>',required:!0,"class":"pdsdk-editor-define-relation-range"},{type:"custom",key:"isFunctional",label:"类型",mode:"label",html:'<div class="pdsdk-editor-define-attribute-modify-select">\n                        <select class="pdsdk-editor-define-attribute-table-select" name="isFunctional">\n                            <option value="0">非单值型</option>\n                            <option value="1">单值型</option>\n                        </select>\n                    </div>'}]},e.prototype.initSettings=function(i){var a=$.extend(!0,{},e.defaultSettings);return $.extend(!0,{},t.prototype.initSettings.call(this,a),i)},e.prototype.onClick=function(t){var e=this;this.getAttributeList().then(function(t){var i=lodash_1.filter(t.rsData,["type",e.settings.attributeType]);e.attributeListData=i,e.drawAttributeList(i)}),this.$attributeList.find(".pdsdk-editor-define-attribute-name").text(this.data.name).attr("title",this.data.name),this.$attributeList.removeClass("hide")},e.defaultSettings={attributeType:"1",key:"id",rangeKey:"range",cls:["pd-btn-float","pdsdk-editor-button-border"],name:"defineRelation",title:"关系定义",disabled:!0,visible:!1,icon:format_list_bulleted_1["default"](20),addPromptSettings:e.defaultPromptSettings,editPromptSettings:e.defaultPromptSettings,localization:{tableTitle1:"关系名称",tableTitle2:"值域",tableTitle3:"属性类型",listTitle:"关系",listType:"对象"}},e}(editor_define_relation_1.PdSDKEditorDefineRelation);exports.PdSDKEditorDefineRelationConcept=PdSDKEditorDefineRelationConcept;