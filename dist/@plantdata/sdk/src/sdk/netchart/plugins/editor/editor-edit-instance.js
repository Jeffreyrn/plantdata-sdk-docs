"use strict";var __extends=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function a(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(a.prototype=i.prototype,new a)}}();Object.defineProperty(exports,"__esModule",{value:!0});var $=require("jquery"),form_1=require("../../../../ui/components/form/form"),utils_1=require("../../../utils/utils"),common_1=require("../../../../common/common"),edit_item_1=require("../../../../vis/utils/edit-item/edit-item"),editor_edit_entity_1=require("./editor-edit-entity"),mode_edit_1=require("../../../../icon/mode-edit"),PdSDKEditorEditInstance=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.addParent=function(t){var e=this.settings.ajaxSettings,i=e.queryData||{},a=e.formData||{};i.kgName=this.settings.kgName,a.instanceId=this.data.id,a.parentId=t.id;var n={url:e.baseUrl+"instance/add/parent",type:"POST",data:a};return n=$.extend(!0,{},n,e,this.settings.addParentSettings),n.url=utils_1.PdSDKUtils.buildUrl(n.url,i),utils_1.PdSDKUtils.ajax(n)},e.prototype.deleteParent=function(t){var e=this.settings.ajaxSettings,i=e.queryData||{},a=e.formData||{};i.kgName=this.settings.kgName,a.instanceId=this.data.id,a.parentId=t.id,delete a.parent;var n={url:e.baseUrl+"instance/delete/parent",type:"POST",data:a};return n=$.extend(!0,{},n,e,this.settings.deleteParentSettings),n.url=utils_1.PdSDKUtils.buildUrl(n.url,i),utils_1.PdSDKUtils.ajax(n)},e.prototype.updateStatusBySelection=function(t,e,i){if(1===t.length&&0===e.length){var a=t[0];0===a.type?(this.updateStatus(!1),this.updateVisibility(!1)):1===a.type&&(this.data=a,this.updateStatus(!0),this.updateVisibility(!0))}else this.updateStatus(!1),this.updateVisibility(!1)},e.prototype.updateAbstract=function(t){var e=this.settings.ajaxSettings,i=e.queryData||{},a=e.formData||{};i.kgName=this.settings.kgName,a=$.extend(!0,{},t),a.instanceId=this.data.id;var n={url:e.baseUrl+"instance/update/abstract",type:"POST",data:a};return n=$.extend(!0,{},n,e,this.settings.updateAbstractSettings),n.url=utils_1.PdSDKUtils.buildUrl(n.url,i),utils_1.PdSDKUtils.ajax(n)},e.prototype.updateNameAndMeaningTag=function(t){var e=this.settings.ajaxSettings,i=e.queryData||{},a=e.formData||{};i.kgName=this.settings.kgName,a=$.extend(!0,{},t),a.instanceId=this.data.id;var n={url:e.baseUrl+"instance/update/nameAndMeaningTag",type:"POST",data:a};return n=$.extend(!0,{},n,e,this.settings.nameAndMeaningTagSettings),n.url=utils_1.PdSDKUtils.buildUrl(n.url,i),utils_1.PdSDKUtils.ajax(n)},e.prototype.bindDialogEvent=function(){var e=this;this.editDialog.$el.find(".pdvis-edit-item").on("blur",'input[name="name"]',function(t){if($(t.currentTarget).hasClass("pdsdk-editor-change")){var i=$(t.currentTarget).val(),a=e.editDialog.$el.find(".pdvis-edit-item").find('input[name="meaningTag"]').val();i?e.updateNameAndMeaningTag({name:i,meaningTag:a}).then(function(a){e.data.name=i,$(t.currentTarget).removeClass("pdsdk-editor-change"),e.updateNode(e.settings.netChart,e.data),common_1.PdCommonUtils.success("实体名称修改成功")}):common_1.PdCommonUtils.error("实体名不能为空")}}),t.prototype.bindDialogEvent.call(this)},e.prototype.createEditDialogSettings=function(){for(var t="",i=0,a=e.editFormSettings;i<a.length;i++){var n=a[i];t+=edit_item_1.PdVisEditItem.gentEditItem(n)}return{cls:"pdsdk-editor-edit-entity-dialog pdsdk-editor-common-dialog",title:'实体"<span class="pdsdk-editor-edit-instance-name"></span>"'+this.settings.title,body:t,positiveClick:function(){return Promise.resolve({})}}},e.prototype.getInstanceDetail=function(){var t=this.settings.ajaxSettings,e=t.queryData||{};e.kgName=this.settings.kgName,e.instanceId=this.data.id;var i={url:t.baseUrl+"instance/get",type:"GET"};return i=$.extend(!0,{},i,t,this.settings.instanceDetailSettings),i.url=utils_1.PdSDKUtils.buildUrl(i.url,e),utils_1.PdSDKUtils.ajax(i)},e.prototype.initSettings=function(i){var a=$.extend(!0,{},e.defaultSettings);return a.parentPromptSettings.ajaxSettings=$.extend(!0,{},i.ajaxSettings,a.parentPromptSettings.ajaxSettings),$.extend(!0,{},t.prototype.initSettings.call(this,a),i)},e.prototype.onClick=function(t){var e=this;this.editDialog.$el.find(".pdsdk-editor-edit-instance-name").text(this.data.name),this.getInstanceDetail().then(function(t){e.pars=t.pars||[],form_1.PdUIForm.setFormData(e.editDialog.$el,t)}),this.showEdit({},t)},e.prototype.updateImage=function(t){var e=this.settings.ajaxSettings,i=e.queryData||{},a=e.formData||{};i.kgName=this.settings.kgName,i.id=this.data.id,a=$.extend(!0,{},t);var n={url:e.baseUrl+"general/add/imageUrl",type:"POST",data:a};return n=$.extend(!0,{},n,e,this.settings.updateImageUrlSettings),n.url=utils_1.PdSDKUtils.buildUrl(n.url,i),utils_1.PdSDKUtils.ajax(n)},e.defaultPromptSettings={promptType:"100"},e.defaultSettings={cls:["pd-btn-float"],name:"editInstance",title:"编辑",disabled:!0,visible:!1,icon:mode_edit_1["default"](20),parentPromptSettings:e.defaultPromptSettings},e.editFormSettings=[{type:"input",key:"name",label:"实体名称",mode:"label",required:!0},{type:"input",key:"meaningTag",label:"消歧标识",mode:"label"},{type:"textarea",key:"abs",label:"描述",mode:"label"},{type:"input",key:"imageUrl",label:"图片",mode:"label"}],e}(editor_edit_entity_1.PdSDKEditorEditEntity);exports.PdSDKEditorEditInstance=PdSDKEditorEditInstance;