"use strict";var __extends=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();Object.defineProperty(exports,"__esModule",{value:!0});var $=require("jquery"),lodash_1=require("lodash");require("echarts/lib/component/title");var edit_item_1=require("../../../../../vis/utils/edit-item/edit-item"),form_1=require("../../../../../ui/components/form/form"),message_1=require("../../../../../ui/components/message/message"),stats_tool_1=require("./stats-tool"),line_bar_1=require("../../../../stats/impls/line-bar"),utils_1=require("../../../../utils/utils"),bar_chart_1=require("../../../../../icon/bar-chart"),PdSDKPluginStatsNetChartBarTool=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.getEditorData=function(){var t=form_1.PdUIForm.getFormData(this.$editor);return t.xAxis?t.yAxis?(this.settings.rule=t,t):void message_1.PdUIMessage.error("Y轴不能为空"):void message_1.PdUIMessage.error("X轴不能为空")},e.prototype.rendererData=function(){var t=this;this.updateTitle();var e=this.buildRequest();return utils_1.PdSDKUtils.ajax(e).then(function(i){return e.success?i:(t.data=i,i.length?(t.$el.removeClass("no-data"),setTimeout(function(){t.rendererChart()},10),i):(t.$el.addClass("no-data"),Promise.reject(new Error("无数据"))))})},e.prototype.activeBar=function(t){},e.prototype.createChart=function(t,e){void 0===e&&(e=!1);for(var i=[],s=[],r=0,a=this.data;r<a.length;r++){var n=a[r];i.push(n.name),s.push(n.value)}var o=this.settings.rule,d=$.extend(!0,{title:{text:o.title,show:e,left:0,top:0,textStyle:{align:"center",lineHeight:64,fontSize:12,fontWeight:"normal",color:"#666"}},grid:{top:30}},this.settings.chartSettings,o.chartSettings);return new line_bar_1.PdSDKStatLineBar({data:{xAxis:[{data:i,name:""}],series:[{data:s,name:"",barMaxWidth:30}]},type:"bar",chartSettings:d,selector:t})},e.prototype.createEditForm=function(){var t=edit_item_1.PdVisEditItem.createInput({key:"title",required:!0}),e=this.createXSelect(),i=this.createYSelect(),s=bar_chart_1["default"](200),r='<div><div class="pdsdk-stats-chart-edit-form"><div class="pdsdk-stats-chart-edit-title"><label>标题:</label>'+t+'</div><div class="pdsdk-stats-chart-edit-icon">'+s+'</div><div class="pdsdk-stats-chart-edit-x"><label>X:</label>'+e+'</div><div class="pdsdk-stats-chart-edit-y"><label>Y:</label>'+i+'</div></div><div class="pdsdk-stats-chart-edit-control"><button class="pdui-btn pdui-btn-sm pdui-btn-primary-outline pdsdk-stats-chart-edit-cancel">取消</button><button class="pdui-btn pdui-btn-sm pdui-btn-primary pdsdk-stats-chart-edit-confirm">确定</button></div></div>';return $(r)},e.prototype.createTitle=function(){var t=lodash_1.find(this.settings.xAxisOptions,["value",this.settings.rule.xAxis.toString()]),e=lodash_1.find(this.settings.yAxisOptions,["value",this.settings.rule.yAxis.toString()]);return(t?t.label:"")+"的"+(e?e.label:"")+"统计"},e.prototype.createXSelect=function(){return edit_item_1.PdVisEditItem.createSelect({key:"xAxis",options:this.settings.xAxisOptions})},e.prototype.createYSelect=function(){return edit_item_1.PdVisEditItem.createSelect({key:"yAxis",options:this.settings.yAxisOptions})},e.prototype.inactiveBar=function(){this.settings.netChart.clearReducedLink(),this.settings.netChart.clearReducedNode(),this.settings.netChart.clearEmphasisLink(),this.settings.netChart.clearEmphasisNode()},e.prototype.initSettings=function(i){return $.extend(!0,{},t.prototype.initSettings.call(this,e.defaultSettings),i)},e.prototype.rendererChart=function(){var t=this;this.stat&&this.stat.destroy(),this.stat=this.createChart(this.$chart,!0);var e=this.settings.highlightTrigger;"click"===e&&this.stat.chart.on("click",function(e){var i=e.dataIndex;t.inactiveBar(),t.activeBarIndex===i?t.activeBarIndex=null:(t.activeBar(e.dataIndex),t.activeBarIndex=i),t.settings.netChart.updateStyle()}),"hover"===e&&(this.stat.chart.on("mouseover",function(e){t.inactiveBar(),t.activeBar(e.dataIndex),t.settings.netChart.updateStyle()}),this.stat.chart.on("mouseout",function(e){t.inactiveBar(),t.settings.netChart.updateStyle()}))},e.prototype.updateTitle=function(){this.settings.rule.title||(this.settings.rule.title=this.createTitle())},e.defaultSettings={highlightTrigger:"click",yAxisOptions:[{value:"count",label:"数量"}],rule:{}},e}(stats_tool_1.PdSDKPluginStatsTool);exports.PdSDKPluginStatsNetChartBarTool=PdSDKPluginStatsNetChartBarTool;