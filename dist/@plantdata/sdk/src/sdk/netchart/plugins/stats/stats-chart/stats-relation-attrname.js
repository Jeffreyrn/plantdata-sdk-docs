"use strict";var __extends=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function s(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(s.prototype=i.prototype,new s)}}();Object.defineProperty(exports,"__esModule",{value:!0});var $=require("jquery"),lodash_1=require("lodash"),edit_item_1=require("../../../../../vis/utils/edit-item/edit-item"),utils_1=require("../../../../utils/utils"),stats_netchart_bar_tool_1=require("./stats-netchart-bar-tool"),PdSDKPluginStatsRelationAttrName=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.activeBar=function(t){var e=this.settings.netChart.getAvailableData();if(e){var i=this.data[t].ids;if(i.length)this.settings.netChart.setEmphasisLink(i);else{var s=lodash_1.map(e.links,"id");this.settings.netChart.setReducedLink(s)}}},e.prototype.bindEvent=function(){var e=this;t.prototype.bindEvent.call(this),this.addEvent("schemaUpdate",function(t){e.settings.schema=t.schema,e.updateConceptOptions()},this.settings.sdkNetChart),this.addEvent("beforedraw",function(){Object.keys(e.settings.rule).length&&(e.inactiveBar(),e.rendererData())},this.settings.netChart)},e.prototype.buildRequest=function(){var t=this.settings.ajaxSettings,e=$.extend(!0,{size:6},t.formData);e.kgName=this.settings.kgName;var i=$.extend(!0,{},t.formData,{tripleIds:this.getRelatedLinkIds(),returnType:1});"-1"!==this.settings.rule.xAxis&&(i.conceptId=this.settings.rule.xAxis);var s={url:t.baseUrl+"graph/stat/relation/count/group/by/attrname",type:"POST",el:this.$el[0],data:i};return s=$.extend(!0,{},s,t),s.url=utils_1.PdSDKUtils.buildUrl(s.url,e),s},e.prototype.createEditForm=function(){return t.prototype.createEditForm.call(this).addClass("pdsdk-stats-relation-attrname")},e.prototype.createXSelect=function(){return edit_item_1.PdVisEditItem.createSelect({key:"xAxis",options:[]})},e.prototype.getRelatedLinkIds=function(){for(var t=this.settings.netChart.getData(),e=t?t.links:[],i=[],s=0,n=e;s<n.length;s++){var r=n[s];i.push(r.id)}return i},e.prototype.initSettings=function(i){var s=$.extend(!0,{},t.prototype.initSettings.call(this,e.defaultSettings),i);return s.rule&&(s.rule.conceptId&&(s.rule.xAxis=s.rule.conceptId),s.rule.yAxis||(s.rule.yAxis=s.yAxisOptions[0].value)),s},e.prototype.mounted=function(){this.updateConceptOptions(),t.prototype.mounted.call(this)},e.prototype.updateConceptOptions=function(){var t=lodash_1.map(this.settings.schema.types,function(t){return{value:t.k.toString(),label:t.v}});this.settings.xAxisOptions=[{value:"-1",label:"全部"}].concat(t);var e=edit_item_1.PdVisEditItem.createSelect({key:"xAxis",options:this.settings.xAxisOptions});this.select('[name="xAxis"]').replaceWith(e)},e.defaultSettings={},e.type="statsRelationAttrName",e.typeName="计算关系类型",e}(stats_netchart_bar_tool_1.PdSDKPluginStatsNetChartBarTool);exports.PdSDKPluginStatsRelationAttrName=PdSDKPluginStatsRelationAttrName;