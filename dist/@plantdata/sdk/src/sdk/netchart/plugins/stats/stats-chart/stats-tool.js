"use strict";var __extends=this&&this.__extends||function(){var t=function(e,s){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s])})(e,s)};return function(e,s){function i(){this.constructor=e}t(e,s),e.prototype=null===s?Object.create(s):(i.prototype=s.prototype,new i)}}();Object.defineProperty(exports,"__esModule",{value:!0});var $=require("jquery"),component_1=require("../../../../../core/component"),form_1=require("../../../../../ui/components/form/form"),dialog_1=require("../../../../../vis/utils/modal/dialog/dialog"),delete_1=require("../../../../../icon/delete"),settings_1=require("../../../../../icon/settings"),bar_chart_1=require("../../../../../icon/bar-chart"),fullscreen_1=require("../../../../../icon/fullscreen"),PdSDKPluginStatsTool=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype["delete"]=function(){this.destroy(),this.settings.onDelete&&this.settings.onDelete(this.settings,this)},e.prototype.destroy=function(){this.stat&&this.stat.destroy(),this.statFull&&this.statFull.destroy(),t.prototype.destroy.call(this),t.prototype.removeDOM.call(this)},e.prototype.getStatsConfig=function(){return this.settings.rule},e.prototype.getStatsSettings=function(){return this.settings},e.prototype.hideEdit=function(){this.$el.removeClass("is-edit")},e.prototype.setStatsSettings=function(t){this.settings=t},e.prototype.showEdit=function(){this.settings.rule&&Object.keys(this.settings.rule).length&&form_1.PdUIForm.setFormData(this.$editor,this.settings.rule),this.$el.addClass("is-edit")},e.prototype.update=function(t){var e=this;this.settings=t,this.rendererData().then(function(){e.hideEdit()},function(){e.hideEdit()}),this.settings.onUpdate&&this.settings.onUpdate(this.settings,this)},e.prototype.bindEvent=function(){var e=this;t.prototype.bindEvent.call(this),this.$el.on("click",".pdsdk-stats-chart-remove",function(){e.settings.beforeDelete?e.settings.beforeDelete(e.settings,e).then(function(t){e["delete"]()}):e["delete"]()}).on("click",".pdsdk-stats-chart-max",function(t){e.fullDialog.open({event:t}),e.statFull&&e.statFull.destroy(),e.statFull=e.createChart(e.fullDialog.select(".pdsdk-stats-chart-full"))}).on("click",".pdsdk-stats-chart-edit",function(){e.showEdit()}).on("click",".pdsdk-stats-chart-edit-cancel",function(){e.hideEdit()}).on("click",".pdsdk-stats-chart-edit-confirm",function(){var t=$.extend(!0,{},e.settings,{rule:e.getEditorData()});e.settings.beforeUpdate?e.settings.beforeUpdate(t,e).then(function(s){e.update(t)}):e.update(t)})},e.prototype.initSettings=function(s){return $.extend(!0,{},t.prototype.initSettings.call(this,e.defaultSettings),s)},e.prototype.initTemplate=function(){var t=$('<div class="pdsdk-stats-chart-item"><div class="pdsdk-stats-chart-control"></div></div>');if(this.$chart=$('<div class="pdsdk-stats-chart-chart"></div>'),t.append(this.$chart),this.settings.editable){var e=settings_1["default"](20);t.find(".pdsdk-stats-chart-control").append('<div class="pdsdk-stats-chart-edit">'+e+"</div>"),this.$editor=this.createEditForm().addClass("pdsdk-stats-chart-editor"),t.append(this.$editor)}var s=fullscreen_1["default"](20);if(t.find(".pdsdk-stats-chart-control").append('<div class="pdsdk-stats-chart-max">'+s+"</div>"),this.settings.deletable){var i=delete_1["default"](20);t.find(".pdsdk-stats-chart-control").append('<div class="pdsdk-stats-chart-remove">'+i+"</div>")}var n=bar_chart_1["default"](200),o='<div class="pdsdk-stats-chart-no-data">'+n+'<div class="pdsdk-stats-chart-no-data-text">无数据</div></div>';return t.append(o),t},e.prototype.mounted=function(){var e=this;t.prototype.mounted.call(this),this.bindEvent(),this.fullDialog=new dialog_1.PdVisDialog({cls:"pdsdk-stats-chart-full-dialog",title:function(){return e.settings.rule.title},body:function(){return'<div class="pdsdk-stats-chart-full"></div>'},positiveText:null,negativeText:null})},e.prototype.unbindEvent=function(){t.prototype.unbindEvent.call(this),this.$el.off("click",".pdsdk-stats-chart-remove").off("click",".pdsdk-stats-chart-max").off("click",".pdsdk-stats-chart-edit").off("click",".pdsdk-stats-chart-edit-cancel").off("click",".pdsdk-stats-chart-edit-confirm")},e.defaultSettings={editable:!0,yAxisOptions:[]},e}(component_1.PdComponent);exports.PdSDKPluginStatsTool=PdSDKPluginStatsTool;