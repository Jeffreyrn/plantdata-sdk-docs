"use strict";var __extends=this&&this.__extends||function(){var t=function(d,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,d){t.__proto__=d}||function(t,d){for(var e in d)d.hasOwnProperty(e)&&(t[e]=d[e])})(d,e)};return function(d,e){function a(){this.constructor=d}t(d,e),d.prototype=null===e?Object.create(e):(a.prototype=e.prototype,new a)}}();Object.defineProperty(exports,"__esModule",{value:!0});var $=require("jquery"),lodash_1=require("lodash"),common_1=require("../../../../common/common"),modal_1=require("../../../../ui/components/modal/modal"),pagination_1=require("../../../../ui/components/pagination/pagination"),form_1=require("../../../../ui/components/form/form"),utils_1=require("../../../utils/utils"),tag_1=require("../../../../ui/components/tag/tag"),button_1=require("../../../../ui/components/button/button"),plugin_1=require("../plugin"),tag_prompt_1=require("../../../utils/tag-prompt/tag-prompt"),close_1=require("../../../../icon/close"),inbox_1=require("../../../../icon/inbox"),add_circle_1=require("../../../../icon/add-circle"),search_1=require("../../../../icon/search"),PdSDKPluginAdvancedPromptDialog=function(t){function d(d){return t.call(this,d)||this}return __extends(d,t),d.prototype.getPluginType=function(){return"advancePromptDialog"},d.prototype.getTagData=function(){return this.data&&this.data.tagData?this.data.tagData:[]},d.prototype.closeDialog=function(){modal_1.PdUIModal.close(this.$el)},d.prototype.openDialog=function(){this.data={},this.buildPage(1,5,1),this.select(".pdsdk-advanced-prompt-select-box").empty(),this.filterData=[],this.select(".pdsdk-advanced-prompt-input").val(""),this.select(".pdsdk-advanced-prompt-concept-select").val("0"),this.select(".pdsdk-advanced-prompt-dialog-filter-add-btn").removeClass("hide"),this.select(".pdsdk-advanced-prompt-dialog-filter-add-box").addClass("hide"),this.select(".pdsdk-advanced-prompt-dialog-filter-list").empty(),this.select(".pdsdk-advanced-prompt-before-search").removeClass("hide").siblings().addClass("hide"),modal_1.PdUIModal.open(this.$el)},d.prototype.updateSchema=function(t){this.settings.schema=t,this.updateOptions()},d.prototype.bindEvent=function(){var d=this;t.prototype.bindEvent.call(this),this.addEvent("schemaUpdate",function(t){d.settings.schema=t.schema,d.updateOptions()},this.settings.sdkNetChart),this.select(".pdsdk-advanced-prompt-input").on("keydown",function(t){13===t.keyCode&&d.select(".pdsdk-advanced-prompt-search").trigger("click")}),this.select(".pdsdk-advanced-prompt-search").on("click",function(t){var e=form_1.PdUIForm.getFormData(d.$el),a=$.trim(e&&e.kw?e.kw:"");d.data?d.data.kw=a:d.data={kw:a},d.search(1)}),this.select(".pdui-table").on("click",".pdsdk-advanced-prompt-add-item",function(t){if(d.data.tagData&&d.settings.max&&d.settings.max<=d.data.tagData.length)common_1.PdCommonUtils.error("选择中分析对象已达上限");else{var e=$(t.currentTarget).attr("data-id"),a=lodash_1.find(d.data.searchData,function(t){return t.id+""==e+""});d.data.tagData?d.data.tagData.push(a):d.data.tagData=[a],$(t.currentTarget).closest(".pdsdk-advanced-prompt-button-cell").html(d.getButton(e)),d.updateTag()}}),this.select(".pdui-table").on("click",".pdsdk-advanced-prompt-remove-item",function(t){var e=$(t.currentTarget).attr("data-id");lodash_1.remove(d.data.tagData,function(t){return t.id+""==e+""}),$(t.currentTarget).closest(".pdsdk-advanced-prompt-button-cell").html(d.getButton(e)),d.updateTag()}),this.select(".pdsdk-advanced-prompt-select-box").on("click",".close-icon",function(t){var e=$(t.currentTarget).closest(".pdui-tag").attr("data-id");lodash_1.remove(d.data.tagData,function(t){return t.id+""==e+""}),d.select(".pdsdk-advanced-prompt-content-main").find(".pdsdk-advanced-prompt-button-cell[data-id="+e+"]").html(d.getButton(e)),$(t.currentTarget).closest(".pdui-tag").remove()}),this.select(".pdsdk-advanced-prompt-submit").on("click",function(){d.data.tagData&&d.data.tagData.length?d.settings.positiveBtn.onclick(d):common_1.PdCommonUtils.error("请选择分析对象")}),this.select(".pdsdk-advanced-prompt-dialog-filter-add-btn").on("click",function(t){var e=form_1.PdUIForm.getFormData(d.select(".pdsdk-advanced-prompt-dialog-search")).concept;if(form_1.PdUIForm.setFormData(d.select(".pdsdk-advanced-prompt-dialog-filter-add-box"),{value:"",lt:"",gt:""}),d.promptTag.setData([]),"0"===e)common_1.PdCommonUtils.warning("请选择概念");else{d.select(".pdsdk-advanced-prompt-dialog-filter-add-line-obj").addClass("hide"),d.select(".pdsdk-advanced-prompt-dialog-filter-add-line-range").addClass("hide"),d.select(".pdsdk-advanced-prompt-dialog-filter-add-line-value").removeClass("hide");var a="",n=lodash_1.filter(d.settings.schema.atts,function(t){return t.domain.toString()===e.toString()});if(n&&n.length){lodash_1.remove(n,function(t){var e=lodash_1.filter(d.filterData,function(d){return d.attrId.toString()===t.k.toString()});return e&&e.length});for(var i=0,s=n;i<s.length;i++){var o=s[i];a+='<option value ="'+o.k+'">'+o.v+"</option>"}}d.select(".pdsdk-advanced-prompt-dialog-filter-add-attr-select").html(a).val(n&&n.length?n[0].k.toString():"").trigger("change"),$(t.currentTarget).addClass("hide").siblings(".pdsdk-advanced-prompt-dialog-filter-add-box").removeClass("hide")}}),this.select(".pdsdk-advanced-prompt-concept-select").on("change",function(t){d.filterData=[],d.select(".pdsdk-advanced-prompt-dialog-filter-list").empty(),d.select(".pdsdk-advanced-prompt-dialog-filter-add-btn").removeClass("hide"),d.select(".pdsdk-advanced-prompt-dialog-filter-add-box").addClass("hide")}),this.select(".pdsdk-advanced-prompt-dialog-filter-add-attr-select").on("change",function(t){var e=$(t.currentTarget).val();if(e){var a=lodash_1.find(d.settings.schema.atts,function(t){return t.k.toString()===e.toString()}),n="",i="";"0"===a.type.toString()?"1"===a.dataType.toString()||"2"===a.dataType.toString()?(i="$gte",n='<option value ="$gte">大于</option>\n                                   <option value ="$lte">小于</option>\n                                   <option value ="$eq">等于</option>\n                                   <option value ="$ne">不等于</option>\n                                   <option value ="range">区间</option>'):(i="$eq",n='<option value ="$eq">等于</option>\n                                   <option value ="$ne">不等于</option>'):"1"===a.type.toString()&&(d.promptRange=a.range,d.select(".pdsdk-advanced-prompt-dialog-filter-add-line-obj").removeClass("hide"),d.select(".pdsdk-advanced-prompt-dialog-filter-add-line-range").addClass("hide"),d.select(".pdsdk-advanced-prompt-dialog-filter-add-line-value").addClass("hide"),i="$in",n='<option value ="$in">存在</option>\n                               <option value ="$nin">不存在</option>'),d.select(".pdsdk-advanced-prompt-dialog-filter-add-operator-select").html(n).val(i).trigger("change")}}),this.select(".pdsdk-advanced-prompt-dialog-filter-add-operator-select").on("change",function(t){"range"===$(t.currentTarget).val()?(d.select(".pdsdk-advanced-prompt-dialog-filter-add-line-obj").addClass("hide"),d.select(".pdsdk-advanced-prompt-dialog-filter-add-line-range").removeClass("hide"),d.select(".pdsdk-advanced-prompt-dialog-filter-add-line-value").addClass("hide")):"$in"===$(t.currentTarget).val()||"$nin"===$(t.currentTarget).val()?(d.select(".pdsdk-advanced-prompt-dialog-filter-add-line-obj").removeClass("hide"),d.select(".pdsdk-advanced-prompt-dialog-filter-add-line-range").addClass("hide"),d.select(".pdsdk-advanced-prompt-dialog-filter-add-line-value").addClass("hide")):(d.select(".pdsdk-advanced-prompt-dialog-filter-add-line-obj").addClass("hide"),d.select(".pdsdk-advanced-prompt-dialog-filter-add-line-range").addClass("hide"),d.select(".pdsdk-advanced-prompt-dialog-filter-add-line-value").removeClass("hide"))}),this.select(".pdsdk-advanced-prompt-dialog-filter-add-cancel").on("click",function(){d.select(".pdsdk-advanced-prompt-dialog-filter-add-box").addClass("hide"),d.select(".pdsdk-advanced-prompt-dialog-filter-add-btn").removeClass("hide")}),this.select(".pdsdk-advanced-prompt-dialog-filter-add-confirm").on("click",function(){var t,e=form_1.PdUIForm.getFormData(d.select(".pdsdk-advanced-prompt-dialog-filter-add-box")),a={};if(!e.attrId)return void common_1.PdCommonUtils.error("请选择属性");var n=close_1["default"](20,{"class":"pdsdk-advanced-prompt-dialog-filter-item-close"}),i=e.attrId;a.attrId=i;var s=lodash_1.find(d.settings.schema.atts,function(t){return t.k.toString()===i.toString()});if("range"===e.relation){if(!e.gt||!e.lt)return void common_1.PdCommonUtils.error("请填写检索值");a.gt=e.gt,a.lt=e.lt,t=$('<div class="pdsdk-advanced-prompt-dialog-filter-item clearfix" conceptId="'+i+'">\n                            <div class="pdsdk-advanced-prompt-dialog-filter-item-tab clearfix">\n                                <div class="advanced-prompt-item-title">'+s.v+'</div>\n                                <div class="advanced-prompt-item-label">区间</div>\n                                <div class="advanced-prompt-item-value" title="'+e.lt+"-"+e.gt+'">\n                                    '+e.lt+'\n                                    <span class="advanced-prompt-item-split">-</span>\n                                    '+e.gt+"\n                                </div>\n                                "+n+"\n                            </div>\n                        </div>")}else if("$in"===e.relation||"$nin"===e.relation){var o=d.promptTag.getData();if(!o||!o.length)return void common_1.PdCommonUtils.error("请填写检索值");a[e.relation]=lodash_1.map(o,"id");var p=lodash_1.map(o,"name").join("、"),l={$in:"存在",$nin:"不存在"};t=$('<div class="pdsdk-advanced-prompt-dialog-filter-item clearfix" conceptId="'+i+'">\n                            <div class="pdsdk-advanced-prompt-dialog-filter-item-tab clearfix">\n                                <div class="advanced-prompt-item-title">'+s.v+'</div>\n                                <div class="advanced-prompt-item-label">'+l[e.relation]+'</div>\n                                <div class="advanced-prompt-item-value" title="'+p+'">\n                                    '+p+"\n                                </div>\n                                "+n+"\n                            </div>\n                        </div>")}else{if(!e.value)return void common_1.PdCommonUtils.error("请填写检索值");a[e.relation]=e.value;var l={$eq:"等于 ",$ne:"不等于",$gte:"大于",$lte:"小于"};t=$('<div class="pdsdk-advanced-prompt-dialog-filter-item clearfix" conceptId="'+i+'">\n                            <div class="pdsdk-advanced-prompt-dialog-filter-item-tab clearfix">\n                                <div class="advanced-prompt-item-title">'+s.v+'</div>\n                                <div class="advanced-prompt-item-label">'+l[e.relation]+'</div>\n                                <div class="advanced-prompt-item-value" title="'+e.value+'">\n                                    '+e.value+"\n                                </div>\n                                "+n+"\n                            </div>\n                        </div>")}d.filterData&&d.filterData.length&&(a.relation="1",t.addClass("pdsdk-advanced-prompt-dialog-filter-item-not-first").prepend('\n                <select class="pdsdk-advanced-prompt-dialog-filter-item-select" name="relation" value="1" attrId="'+i+'">\n                    <option value="1">与</option>\n                    <option value="0">或</option>\n                </select>\n                ')),d.filterData.push(a),d.select(".pdsdk-advanced-prompt-dialog-filter-list").append(t),d.select(".pdsdk-advanced-prompt-dialog-filter-add-box").addClass("hide"),d.select(".pdsdk-advanced-prompt-dialog-filter-add-btn").removeClass("hide")}),this.select(".pdsdk-advanced-prompt-dialog-filter-list").on("click",".pdsdk-advanced-prompt-dialog-filter-item-close",function(t){var e=$(t.currentTarget).closest(".pdsdk-advanced-prompt-dialog-filter-item"),a=e.attr("conceptid");lodash_1.remove(d.filterData,function(t){return t.attrId.toString()===a.toString()}),e.hasClass("pdsdk-advanced-prompt-dialog-filter-item-not-first")||e.next(".pdsdk-advanced-prompt-dialog-filter-item-not-first").removeClass("pdsdk-advanced-prompt-dialog-filter-item-not-first").find("select").remove(),$(t.currentTarget).closest(".pdsdk-advanced-prompt-dialog-filter-item").remove()}),this.select(".pdsdk-advanced-prompt-dialog-filter-list").on("change",".pdsdk-advanced-prompt-dialog-filter-item-select",function(t){for(var e=$(t.currentTarget).attr("attrId"),a=0;a<d.filterData.length;a++)d.filterData[a].attrId.toString()===e&&(d.filterData[a].relation=$(t.currentTarget).val())})},d.prototype.buildPage=function(t,d,e){var a=this,n={cls:"page",selector:this.select(".pdsdk-advanced-prompt-page"),totalItem:e,totalItemShow:!1,pageSize:d,showNum:0,current:t,prevNext:!0,startEnd:!1,jump:!1,callback:function(t,d){a.select(".pdsdk-advanced-prompt-input").val(a.data.kw),a.search(d)}};this.page=new pagination_1.PdUIPagination(n)},d.prototype.created=function(){var d={};this.settings=$.extend(!0,{},d,this.settings),t.prototype.created.call(this)},d.prototype.drawTable=function(t,d){var e=this;this.select(".pdsdk-advanced-prompt-content-main").removeClass("hide").siblings().addClass("hide");for(var a="",n=function(n){var i=t[n];a+='<tr>\n                  <td class="pdsdk-advanced-prompt-normal center">\n                    '+(n<9?d-1+""+(n+1):d+"0")+'\n                  </td>\n                  <td title="'+i.name+'" class="pdsdk-advanced-prompt-name">\n                    '+i.name+'\n                  </td>\n                  <td class="pdsdk-advanced-prompt-normal pdsdk-advanced-prompt-concept">\n                    '+function(){var t=lodash_1.find(e.settings.schema.types,function(t){return t.k+""==i.conceptId+""});return t?t.v:i.conceptId}()+'\n                  </td>\n                  <td class="pdsdk-advanced-prompt-normal pdsdk-advanced-prompt-meaning-tag" title="'+i.meaningTag+'">\n                    '+(i.meaningTag||"-")+'\n                  </td>\n                  <td class="pdsdk-advanced-prompt-button-cell pdsdk-advanced-prompt-table-operation" data-id="'+i.id+'">\n                    '+function(){return e.getButton(i.id)}()+"\n                  </td>\n                </tr>"},i=0;i<t.length;i++)n(i);this.select(".pdsdk-advanced-prompt-tbody").html(a)},d.prototype.getButton=function(t){if(this.data.tagData&&this.data.tagData.length){var d=lodash_1.find(this.data.tagData,function(d){return d.id+""==t+""});if(d)return button_1.PdUIButton.create({html:"已加入",size:"xs",atts:{"data-id":t},cls:"pdsdk-advanced-prompt-remove-item"})}return button_1.PdUIButton.create({html:"加入分析",size:"xs",atts:{"data-id":t},cls:"pdsdk-advanced-prompt-add-item",type:"primary-outline"})},d.prototype.initSettings=function(e){return $.extend(!0,{},t.prototype.initSettings.call(this,d.defaultSettings),e)},d.prototype.initTemplate=function(){var t=close_1["default"](20,{"class":"pdui-modal-close"}),d=close_1["default"](20,{"class":"pdsdk-advanced-prompt-dialog-filter-item-close"}),e=inbox_1["default"](60),a=search_1["default"](24),n=add_circle_1["default"](24),i=button_1.PdUIButton.create({html:"取消",size:"sm",cls:"pdui-modal-close",type:"primary-outline"}),s=button_1.PdUIButton.create({html:"确定",size:"sm",cls:"pdsdk-advanced-prompt-submit",type:"primary"}),o=button_1.PdUIButton.create({html:a,size:"sm",cls:"pdsdk-advanced-prompt-search",type:"primary"}),p=button_1.PdUIButton.create({html:n+"<span>添加条件</span>",size:"sm",cls:"pdsdk-advanced-prompt-dialog-filter-add-btn",type:"primary-outline"}),l=$('\n    <div class="pdsdk-advanced-prompt-dialog pdui-modal pdvis-namespace">\n        <div class="pdui-modal-content">\n            <div class="pdui-modal-head">\n                <span class="pdui-modal-title">高级检索</span>\n                '+t+'\n            </div>\n            <div class="pdui-modal-body clearfix">\n            <div class="pdsdk-advanced-prompt-dialog-body-left">\n                <div class="pdsdk-advanced-prompt-dialog-search clearfix">\n                    <select class="pdui-select pdsdk-advanced-prompt-concept-select" name="concept">\n                        <option value ="0">全部</option>\n                    </select>\n                    <input\n                      class="pdui-input pdui-input-sm pdsdk-advanced-prompt-input"\n                      type="text"\n                      value=""\n                      name="kw"\n                      autocomplete="off"\n                      placeholder="请输入关键字">\n                    '+o+'\n                </div>\n                <div class="pdsdk-advanced-prompt-dialog-filter">\n                    <div class="pdsdk-advanced-prompt-dialog-filter-title">\n                        检索条件\n                    </div>\n                    <div class="pdsdk-advanced-prompt-dialog-filter-list">\n                        <div class="pdsdk-advanced-prompt-dialog-filter-item clearfix hide">\n                            <div class="pdsdk-advanced-prompt-dialog-filter-item-tab clearfix">\n                                <div class="advanced-prompt-item-title">注册资本</div>\n                                <div class="advanced-prompt-item-label">介于</div>\n                                <div class="advanced-prompt-item-value">\n                                    2000\n                                    <span class="advanced-prompt-item-split">-</span>\n                                    20000000\n                                </div>\n                                '+d+'\n                            </div>\n                        </div>\n                        <div class="pdsdk-advanced-prompt-dialog-filter-item clearfix hide\n                         pdsdk-advanced-prompt-dialog-filter-item-not-first">\n                            <select></select>\n                            <div class="pdsdk-advanced-prompt-dialog-filter-item-tab clearfix">\n                                <div class="advanced-prompt-item-title">注册资本</div>\n                                <div class="advanced-prompt-item-label">介于</div>\n                                <div class="advanced-prompt-item-value">\n                                    2000\n                                    <span class="advanced-prompt-item-split">-</span>\n                                    20000000\n                                </div>\n                                '+d+'\n                            </div>\n                        </div>\n                    </div>\n                    <div class="pdsdk-advanced-prompt-dialog-filter-add-box hide">\n                        <div class="pdsdk-advanced-prompt-dialog-filter-add-line clearfix">\n                            <div class="pdsdk-advanced-prompt-dialog-filter-add-label">条件</div>\n                            <select name="attrId" class="pdsdk-advanced-prompt-dialog-filter-add-attr-select"></select>\n                            <select name="relation" class="pdsdk-advanced-prompt-dialog-filter-add-operator-select"></select>\n                        </div>\n                        <div class="pdsdk-advanced-prompt-dialog-filter-add-line\n                         pdsdk-advanced-prompt-dialog-filter-add-line-value clearfix">\n                            <div class="pdsdk-advanced-prompt-dialog-filter-add-label">检索值</div>\n                            <input class="pdui-input pdui-input-sm pdsdk-advanced-prompt-dialog-filter-add-input"\n                             type="text" name="value">\n                        </div>\n                        <div class="pdsdk-advanced-prompt-dialog-filter-add-line\n                         pdsdk-advanced-prompt-dialog-filter-add-line-range clearfix">\n                            <div class="pdsdk-advanced-prompt-dialog-filter-add-label">检索值</div>\n                            <input class="pdui-input pdui-input-sm pdsdk-advanced-prompt-dialog-filter-add-input-lt"\n                             type="text" name="lt">\n                             <span>-</span>\n                            <input class="pdui-input pdui-input-sm pdsdk-advanced-prompt-dialog-filter-add-input-gt"\n                             type="text" name="gt">\n                        </div>\n                        <div class="pdsdk-advanced-prompt-dialog-filter-add-line\n                          pdsdk-advanced-prompt-dialog-filter-add-line-obj clearfix">\n                            <div class="pdsdk-advanced-prompt-dialog-filter-add-label">检索值</div>\n                            <div class="pdsdk-advanced-prompt-dialog-filter-add-tag-prompt"></div>\n                        </div>\n                        <div class="pdsdk-advanced-prompt-dialog-filter-add-line clearfix">\n                            <button class="pdui-btn pdui-btn-xs pdui-btn-primary\n                             pdsdk-advanced-prompt-dialog-filter-add-confirm">确定</button>\n                            <button class="pdui-btn pdui-btn-xs pdui-btn-primary-outline\n                             pdsdk-advanced-prompt-dialog-filter-add-cancel">取消</button>\n                        </div>\n                    </div>\n                    '+p+'\n                </div>\n            </div>\n            <div class="pdsdk-advanced-prompt-dialog-body-right">\n                <div class="pdsdk-advanced-prompt-dialog-body-right-top clearfix">\n                    <div class="pdsdk-advanced-prompt-page-label">搜索结果</div>\n                    <div class="pdsdk-advanced-prompt-page"></div>\n                </div>\n                <div class="pdsdk-advanced-prompt-work-space">\n                    <div class="pdsdk-advanced-prompt-content">\n                        <div class="pdsdk-advanced-prompt-before-search pdsdk-advanced-prompt-content-empty">\n                            <div class="pdsdk-advanced-prompt-empty-content">\n                                '+e+'\n                                <span>请先输入查找关键词~</span>\n                            </div>\n                        </div>\n                        <div class="pdsdk-advanced-prompt-no-data pdsdk-advanced-prompt-content-empty hide">\n                            <div class="pdsdk-advanced-prompt-empty-content">\n                                '+e+'\n                                <span>没有搜索到结果~</span>\n                            </div>\n                        </div>\n                        <div class="pdsdk-advanced-prompt-content-main hide">\n                            <table class="pdui-table" width="100%">\n                                <thead>\n                                    <tr>\n                                        <th class="">\n                                            &nbsp;&nbsp;序号&nbsp;&nbsp;\n                                        </th>\n                                    <th class="">\n                                        名称\n                                    </th>\n                                    <th class="">\n                                        概念\n                                    </th>\n                                    <th class="">\n                                        消歧标识\n                                    </th>\n                                    <th class="">\n                                        操作\n                                    </th>\n                                </tr>\n                            </thead>\n                            <tbody class="pdsdk-advanced-prompt-tbody">\n                            </tbody>\n                        </table>\n                    </div>\n                    </div>\n                </div>\n            </div>\n            </div>\n            <div class="pdui-modal-foot clearfix">\n                <div class="pdsdk-advanced-prompt-select-container">\n                    <span>已选分析对象：</span>\n                    <div class="pdsdk-advanced-prompt-select-box"></div>\n                </div>\n                '+i+"\n                "+s+"\n            </div>\n        </div>");return l.appendTo(this.settings.parent),l},d.prototype.mounted=function(){var d=this;this.updateOptions(),this.buildPage(1,5,1),t.prototype.mounted.call(this);var e=this.select(".pdsdk-advanced-prompt-dialog-filter-add-tag-prompt"),a=$.extend(!0,{},{kgName:this.settings.kgName,ajaxSettings:this.settings.ajaxSettings,dynamicSettings:function(t){return $.extend(!0,{},t,{queryData:{allowTypes:d.promptRange}})},schema:this.settings.schema},this.settings.promptSettings);this.promptTag=new tag_prompt_1.PdSDKTagPrompt({size:"sm",data:[],labelKey:"name",valueKey:"id",selector:e,beforeAdd:function(t){return Promise.resolve(t)},beforeDelete:function(t){return Promise.resolve(t)},promptSettings:a}),this.bindEvent()},d.prototype.search=function(t){var d=this,e=form_1.PdUIForm.getFormData(this.$el).concept||"0",a=$.extend(!0,{},{ajaxSettings:this.settings.ajaxSettings},this.settings.searchSettings),n=a.ajaxSettings,i=n.queryData||{},s={};s.kw=this.data.kw,s.conceptId=e,s.query=this.filterData,i.pageNo=t,i.kgName=this.settings.kgName;var o=n.queryData.pageSize,p=t*o,l={url:n.baseUrl+"app/senior/prompt",type:"POST",data:s,el:this.select(".pdsdk-advanced-prompt-content")[0]};l=$.extend(!0,{},l,n),l.url=utils_1.PdSDKUtils.buildUrl(l.url,i),utils_1.PdSDKUtils.ajax(l).then(function(e){return l.success?e:(e&&e.length?(e.length===o&&(p+=1),d.drawTable(e,t)):d.select(".pdsdk-advanced-prompt-no-data").removeClass("hide").siblings().addClass("hide"),d.data.searchData=e,d.buildPage(t,o,p),void 0)})},d.prototype.unbindEvent=function(){t.prototype.unbindEvent.call(this),this.select(".pdsdk-advanced-prompt-input").off("keydown"),this.select(".pdsdk-advanced-prompt-search").off("click"),this.select(".pdui-table").off("click",".pdsdk-advanced-prompt-add-item"),this.select(".pdui-table").off("click",".pdsdk-advanced-prompt-remove-item"),this.select(".pdsdk-advanced-prompt-select-box").off("click",".close-icon"),this.select(".pdsdk-advanced-prompt-submit").off("click"),this.select(".pdsdk-advanced-prompt-dialog-filter-add-btn").off("click"),this.select(".pdsdk-advanced-prompt-concept-select").off("change"),this.select(".pdsdk-advanced-prompt-dialog-filter-add-attr-select").off("change"),this.select(".pdsdk-advanced-prompt-dialog-filter-add-operator-select").off("change"),this.select(".pdsdk-advanced-prompt-dialog-filter-add-cancel").off("click"),this.select(".pdsdk-advanced-prompt-dialog-filter-add-confirm").off("click"),this.select(".pdsdk-advanced-prompt-dialog-filter-list").off("click",".pdsdk-advanced-prompt-dialog-filter-item-close"),this.select(".pdsdk-advanced-prompt-dialog-filter-list").off("change",".pdsdk-advanced-prompt-dialog-filter-item-select")},d.prototype.updateOptions=function(){for(var t='<option value ="0">全部</option>',d=0,e=this.settings.schema.types;d<e.length;d++){var a=e[d];t+='<option value ="'+a.k+'">'+a.v+"</option>"}this.select(".pdsdk-advanced-prompt-concept-select").html(t)},d.prototype.updateTag=function(){for(var t="",d=0,e=this.data.tagData;d<e.length;d++){var a=e[d];t+=tag_1.PdUITag.create({html:a.name,atts:{"data-id":a.id},size:"sm",cls:"pdui-dynamic",type:"primary",removable:!0})}this.select(".pdsdk-advanced-prompt-select-box").html(t)},d.defaultSettings={side:"mask",parent:"body",searchSettings:{ajaxSettings:{queryData:{pageSize:10,type:"010",isFuzzy:!0,isInherit:!0}}}},d}(plugin_1.PdSDKPlugin);exports.PdSDKPluginAdvancedPromptDialog=PdSDKPluginAdvancedPromptDialog;