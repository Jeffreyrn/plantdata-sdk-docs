"use strict";var __extends=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}();Object.defineProperty(exports,"__esModule",{value:!0});var $=require("jquery"),common_1=require("../../../../common/common"),prompt_1=require("../../../prompt/prompt"),plugin_1=require("../plugin"),search_1=require("../../../../icon/search"),close_1=require("../../../../icon/close"),timeline_1=require("../../../../icon/timeline"),PdSDKPluginPath=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.getLoadParams=function(){var t=this.start,e=this.end;if(t&&e){if(t.id.toString()!==e.id.toString()){var n={id:t.id+","+e.id};return n.start=t,n.end=e,n.$type="path",n}common_1.PdCommonUtils.error("起点与终点不能相同")}else common_1.PdCommonUtils.error("起点和终点不能为空");return null},e.prototype.getPluginType=function(){return"path"},e.prototype.bindEvent=function(){var e=this;t.prototype.bindEvent.call(this),this.setPathInfo(),this.addEvent("beforedraw",function(){var t=e.container.loadParams.$source;"dblClick"!==t&&"merge"!==t&&e.setPathInfo()}),this.select(".pdsdk-path-preview .pdsdk-path-btn-preview").on("click",function(){var t=e.getLoadParams();t&&e.container.load(t,"api-path")})},e.prototype.initSettings=function(n){return $.extend(!0,{},t.prototype.initSettings.call(this,e.defaultSettings),n)},e.prototype.initTemplate=function(){var t="路径发现",e=timeline_1["default"](20),n=search_1["default"](24,{fill:"#fff"}),o='<div class="pdsdk-path"><div class="pdsdk-path-prompt-container pdsdk-path-start-container"><div class="pdsdk-path-label">起点：</div><div class="pdsdk-path-start"></div></div><div class="pdsdk-path-prompt-container pdsdk-path-end-container"><div class="pdsdk-path-label">终点：</div><div class="pdsdk-path-end"></div></div><div class="pdsdk-path-preview"><button class="pdui-btn pdui-btn-primary pdsdk-path-btn-preview" title="分析" data-pdui-tooltip="hover" data-pdui-tooltip-position="right">'+n+"</button></div></div>";return this.buildPluginTemplate(o,e,t)},e.prototype.mounted=function(){var e=this;t.prototype.mounted.call(this);var n=close_1["default"](16,{fill:"#aaa"}),o={autocompleteSettings:{icon:{close:{content:n},enter:{enable:!1}}}},i=$.extend(!0,{},o,{autocompleteSettings:{placeholder:"请输入起点",icon:{search:{content:'<div class="pdsdk-path-prompt-title" data-pdui-tooltip="hover" data-pdui-tooltip-position="bottom" title="起点"></div>'}},onSearch:function(t,n,o){e.start=t,e.startPrompt.autocomplete.setSearchText(t.name)},onSelectItemChange:function(t,n,o){if(t){var i=e.startPrompt.autocomplete.getSearchText();t.name===i&&(e.start=t)}else e.start=null},onSearchTextChange:function(t,n,o){e.start=null}}},this.settings.promptSettings),r=$.extend(!0,{},o,{autocompleteSettings:{placeholder:"请输入终点",icon:{search:{content:'<div class="pdsdk-path-prompt-title" data-pdui-tooltip="hover" data-pdui-tooltip-position="bottom" title="终点"></div>'}},onSearch:function(t,n,o){e.end=t,e.endPrompt.autocomplete.setSearchText(t.name)},onSelectItemChange:function(t,n,o){if(t){var i=e.endPrompt.autocomplete.getSearchText();t.name===i&&(e.end=t)}else e.end=null},onSearchTextChange:function(t,n,o){e.end=null}}},this.settings.promptSettings);i.selector=".pdsdk-path-start",r.selector=".pdsdk-path-end",this.startPrompt=new prompt_1.PdSDKPrompt(i),this.endPrompt=new prompt_1.PdSDKPrompt(r),this.bindEvent()},e.prototype.setPathInfo=function(){var t=this.container,e=t.loadParams;e&&(e.start&&(this.start=e.start,this.startPrompt.autocomplete.setSearchText(e.start.name)),e.end&&(this.end=e.end,this.endPrompt.autocomplete.setSearchText(e.end.name)),e.id=e.id||common_1.PdCommonUtils.createId("path-"))},e.prototype.unbindEvent=function(){t.prototype.unbindEvent.call(this),this.select(".pdsdk-path-preview .pdsdk-path-btn-preview").off("click")},e.defaultSettings={side:"left",promptSettings:{autocompleteSettings:{size:"md",theme:"normal"}}},e}(plugin_1.PdSDKPlugin);exports.PdSDKPluginPath=PdSDKPluginPath;