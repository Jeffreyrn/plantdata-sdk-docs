"use strict";var __extends=this&&this.__extends||function(){var t=function(o,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var n in o)o.hasOwnProperty(n)&&(t[n]=o[n])})(o,n)};return function(o,n){function i(){this.constructor=o}t(o,n),o.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(exports,"__esModule",{value:!0});var $=require("jquery"),infobox_1=require("../../../infobox/infobox"),utils_1=require("../../../utils"),plugins_1=require("../../../../vis/netchart/plugins"),knowledge_card_1=require("../../../../icon/knowledge-card"),PdSDKPluginInfobox=function(t){function o(o){var n=t.call(this,o)||this;return n.infoboxCacheMap={},n}return __extends(o,t),o.prototype.getPluginType=function(){return"infobox"},o.prototype.load=function(t){var o=this;if(this.node=t,this.infobox.loadParams?this.infobox.loadParams.query=t:this.infobox.loadParams={query:t},this.settings.cacheable&&this.infoboxCacheMap[t.id]){var n=this.infoboxCacheMap[t.id];return this.infobox.buildInfobox(n),Promise.resolve(n)}return this.infobox.load(t).then(function(n){return o.settings.cacheable&&(o.infoboxCacheMap[t.id]=n),Promise.resolve(n)})},o.prototype.bindEvent=function(){var o=this;t.prototype.bindEvent.call(this),this.addEvent("beforedraw",function(t){var n=t.data&&t.data.nodes;n&&n.length&&o.load({id:n[0].id})}),this.addEvent("click",function(t){t.clickNode&&o.load({id:t.clickNode.id})}),this.addEvent("takeSnapshot",function(t){t.snapshot.infobox=o.node}),this.addEvent("restoreSnapshot",function(t){o.node=t.snapshot.infobox,o.load(o.node)})},o.prototype.initInfobox=function(){var t=$.extend(!0,{container:this.select(".pdsdk-infobox-container")},this.settings.infoboxSettings);this.infobox=new infobox_1.PdSDKInfobox(t)},o.prototype.initSettings=function(n){return $.extend(!0,{},t.prototype.initSettings.call(this,o.defaultSettings),n)},o.prototype.initTemplate=function(){var t="知识卡片",o=knowledge_card_1["default"](20),n='<div class="pdsdk-infobox-container"></div>';return this.buildPluginTemplate(n,o,t)},o.prototype.mounted=function(){t.prototype.mounted.call(this),this.initInfobox(),this.bindEvent()},o.defaultSettings={side:"right",cacheable:!0,infoboxSettings:{imgBuilder:utils_1.PdSDKUtils.imgBuilder,ajaxSettings:{formData:{isRelationAtts:!0}}}},o}(plugins_1.PdVisPlugin);exports.PdSDKPluginInfobox=PdSDKPluginInfobox;