"use strict";var __extends=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(exports,"__esModule",{value:!0});var $=require("jquery"),timing_1=require("../timing"),relation_1=require("../plugins/model/relation"),lodash_1=require("lodash"),common_1=require("../../../common/common"),filter_1=require("../plugins/filter/filter"),PdSDKRelationTiming=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.defaultType="relationtiming",e}return __extends(e,t),e.prototype.buildFilter=function(e){var i=t.prototype.buildFilter.call(this,[{key:"distance",label:"设定分析步长",selected:3,options:[3,4,5,6],customEnable:!0,index:0}]);return filter_1.PdSDKPluginFilter.mergeFilterSettings(i,e)},e.prototype.buildLoaderParams=function(e){var i=t.prototype.buildLoaderParams.call(this,e);if("dblClick"===e.$source){var n=t.prototype.buildGraphLoaderParams.call(this,e);return $.extend(!0,i,n)}e.$type="relation";var o=lodash_1.map(e.nodes,"id"),r=this.settings.loaderSettings.ajaxSettings,s=$.extend({kgName:this.settings.loaderSettings.kgName},r.queryData),a=$.extend({isInherit:!this.settings.showAllSchemaOptions},r.formData);if(a.ids=o,this.filter){var l=this.filter.getFilterOptions();$.extend(a,l)}var d={queryData:s,formData:a,url:r.url||r.baseUrl+"network/relation/timing"};return $.extend(!0,i,d)},e.prototype.destroyPlugins=function(){t.prototype.destroyPlugins.call(this),this.relation&&this.relation.destroy()},e.prototype.graphInitSuccess=function(t){if(this.initFilterOptions(t.config),t=t.entities,t&&t.length&&t.length>1){for(var e=common_1.PdCommonUtils.createId("relation-timing-"),i=t.splice(0,3),n=0,o=i;n<o.length;n++){var r=o[n];r=this.transferNode2Param(r)}this.load({id:e,nodes:i},"init-timing-relation")}},e.prototype.initPlugins=function(){var e=this;this.settings.advancedPrompt=$.extend(!0,{},{settings:{max:null,positiveBtn:{onclick:function(t){var i=t.getTagData();if(i&&i.length>=2){for(var n=[],o=0,r=i;o<r.length;o++){var s=r[o];n.push({id:s.id})}e.load({id:"",nodes:n},"user-relation-timing"),t.closeDialog()}else common_1.PdCommonUtils.error("关联分析至少需要两个节点")}}}},this.settings.advancedPrompt);var i=this.settings;i.event.settings.active=!1,i.event.settings.titleType="short";var n={container:this.netChart};if(i.relation&&i.relation.enable){var o=$.extend(!0,{promptSettings:{schema:this.schema,promptSettings:this.settings.promptSettings}},n,i.relation.settings);this.relation=new relation_1.PdSDKPluginRelation(o)}t.prototype.initPlugins.call(this)},e.prototype.initSettings=function(i){return $.extend(!0,{},t.prototype.initSettings.call(this,e.defaultSettings),i)},e.prototype.updateFixedNodes=function(){var t=this.netChart,e=t.loadParams,i=t.data;if(e)if("dblClick"===e.$source)this.updateGraphLoadParams();else if(i.nodes&&i.nodes.length){if(t.fixedNodes=[],e.nodes)for(var n=0,o=0,r=e.nodes;o<r.length;o++){var s=r[o],a=s.id?"id":"name";e.nodes[n]=lodash_1.find(i.nodes,[a,s[a].toString()])||i.nodes[n],t.fixedNodes.push(e.nodes[n]),n++}t.fixedNodes=lodash_1.compact(t.fixedNodes)}},e.defaultSettings={relation:{enable:!0,settings:{active:!0}},contextmenu:{enable:!0,settings:{menu:{"sub-graph":{enable:!1},"node-focus-to":{enable:!1}}}},filter:{settings:{editItemSettings:[{key:"hyponymyDistance",disabled:!0}]}}},e}(timing_1.PdSDKTiming);exports.PdSDKRelationTiming=PdSDKRelationTiming;