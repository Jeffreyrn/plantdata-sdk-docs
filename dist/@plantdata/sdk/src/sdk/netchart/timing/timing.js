"use strict";var __extends=this&&this.__extends||function(){var t=function(e,i){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(e,i)};return function(e,i){function n(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(exports,"__esModule",{value:!0});var $=require("jquery"),lodash_1=require("lodash"),prompt_1=require("../plugins/prompt/prompt"),netchart_1=require("../netchart"),time_chart_1=require("../plugins/stats/time-chart"),event_1=require("../plugins/event"),page_1=require("../../../vis/netchart/plugins/page"),PdSDKTiming=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.defaultType="timing",e}return __extends(e,t),e.prototype.buildLoaderParams=function(e){var i=t.prototype.buildLoaderParams.call(this,e);e.$type="timing";var n=this.settings.loaderSettings.ajaxSettings,r=$.extend({kgName:this.settings.loaderSettings.kgName},n.queryData),a=$.extend({isRelationMerge:!0,isInherit:!this.settings.showAllSchemaOptions},n.formData);if(a.id=e.id,this.filter){var s=this.filter.getFilterOptions();$.extend(a,s)}if(this.timeChart){var o=lodash_1.cloneDeep(this.timeChart.getSettings());delete o.nodesShowType,$.extend(!0,a,o)}this.page&&(i.queryData.pageNo=this.page.pageNo,i.queryData.pageSize=this.page.pageSize);var p={queryData:r,formData:a,url:n.url||n.baseUrl+"app/graph/timing"};return $.extend(!0,i,p)},e.prototype.destroyPlugins=function(){t.prototype.destroyPlugins.call(this),this.event&&this.event.destroy(),this.page&&this.page.destroy(),this.prompt&&this.prompt.destroy(),this.timeChart&&this.timeChart.destroy()},e.prototype.graphInitSuccess=function(e){t.prototype.graphInitSuccess.call(this,e),e=e.entities,e&&e.length&&this.load(this.transferNode2Param(e[0]),"init-timing")},e.prototype.initNetChart=function(){t.prototype.initNetChart.call(this),this.netChart.$el.addClass("pdsdk-timing")},e.prototype.initPlugins=function(){var e=this;this.settings.advancedPrompt=$.extend(!0,{},{settings:{max:1,positiveBtn:{onclick:function(t){e.load({id:t.data.tagData[0].id},"user-timing"),t.closeDialog()}}}},this.settings.advancedPrompt),t.prototype.initPlugins.call(this);var i=this.settings;if(i.page&&i.page.enable){var n=this.createPluginSettings(i.page);this.page=new page_1.PdVisPluginPage(n)}if(i.prompt&&i.prompt.enable){var r={promptSettings:{schema:this.schema,promptSettings:this.settings.promptSettings}},n=this.createSDKPluginSettings(i.prompt,r);this.prompt=new prompt_1.PdSDKPluginPrompt(n)}if(i.timeChart&&i.timeChart.enable){var n=this.createSDKPluginSettings(i.timeChart);this.timeChart=new time_chart_1.PdSDKPluginTimeChart(n)}if(i.event&&i.event.enable){var n=this.createSDKPluginSettings(i.event);this.event=new event_1.PdSDKPluginEvent(n)}},e.prototype.initSettings=function(i){return $.extend(!0,{},t.prototype.initSettings.call(this,e.defaultSettings),i)},e.prototype.updateFixedNodes=function(){this.updateGraphLoadParams()},e.defaultSettings={pluginSettings:{isVisible:function(t,e){var i=e.getPluginType();return!(["history","filter","prompt"].indexOf(i)<0)||["netChartView","treeView"].indexOf(t)>=0}},prompt:{enable:!0},timeChart:{enable:!0,settings:{style:{left:"100px",right:"16px"}}},event:{enable:!0,settings:{active:!0}},netChartSettings:{leftPanel:{active:!0,mode:"fixed"}},page:{enable:!0,settings:{pageSize:20,side:"top"}}},e}(netchart_1.PdSDKNetChart);exports.PdSDKTiming=PdSDKTiming;