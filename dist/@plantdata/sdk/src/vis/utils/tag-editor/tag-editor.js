"use strict";var __extends=this&&this.__extends||function(){var t=function(e,a){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a])})(e,a)};return function(e,a){function i(){this.constructor=e}t(e,a),e.prototype=null===a?Object.create(a):(i.prototype=a.prototype,new i)}}();Object.defineProperty(exports,"__esModule",{value:!0});var $=require("jquery"),lodash_1=require("lodash"),common_1=require("../../../common/common"),component_1=require("../../../core/component"),tag_1=require("../../../ui/components/tag/tag"),PdVisTagEditor=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.addAble=function(t){return t&&(this.settings.repeatable||!this.existData(t))},e.prototype.addData=function(t){var e=this;if(this.addAble(t)){var a=this.valueToData(t);return this.settings.beforeAdd?this.settings.beforeAdd(a,this).then(function(t){return e.data.push(t),e.updateData(),Promise.resolve(t)}):(this.data.push(a),this.updateData(),Promise.resolve(a))}return Promise.reject("不允许添加")},e.prototype.clearData=function(){this.data=[],this.$dataContainer.empty()},e.prototype.destroy=function(){this.unbindEvent(),t.prototype.destroy.call(this)},e.prototype.existData=function(t){return!!lodash_1.find(this.data,function(e){return e.toString()===t.toString()})},e.prototype.getData=function(){return this.data||[]},e.prototype.setData=function(t){void 0===t&&(t=[]),this.clearData();for(var e=0,a=t;e<a.length;e++){var i=a[e];if(this.addAble(i)){var n=this.valueToData(i);this.data.push(n)}}this.updateData()},e.prototype.valueToData=function(t){return t},e.prototype.bindEvent=function(){var e=this;t.prototype.bindEvent.call(this),this.$dataContainer.on("click",".close-icon",function(t){var a=$(t.currentTarget).closest(".pdvis-tag-editor-item"),i=a.index(),n=e.data[i];return e.settings.beforeDelete?e.settings.beforeDelete(n,e).then(function(t){e.data.splice(i,1),e.updateData()},function(t){common_1.PdCommonUtils.error(t)}):(e.data.splice(i,1),void e.updateData())})},e.prototype.createData=function(t){return tag_1.PdUITag.create({size:this.settings.size,type:"primary",removable:!0,html:"<span>"+t+"</span>",cls:"pdvis-tag-editor-item",atts:{"data-pdui-value":t}})},e.prototype.initSettings=function(a){return $.extend(!0,{},t.prototype.initSettings.call(this,e.defaultSettings),a)},e.prototype.initTemplate=function(){this.$editor=this.createEditor();var t=$(this.settings.selector);this.saveOriginClass(t);var e="pdvis-tag-editor";return this.settings.size&&(e+=" pdvis-tag-editor-"+this.settings.size),t.addClass(e),this.$dataContainer=$('<div class="pdvis-tag-editor-data"></div>'),t.append(this.$dataContainer).append(this.$editor),t},e.prototype.mounted=function(){if(t.prototype.mounted.call(this),this.bindEvent(),this.settings.data){for(var e=[],a=0,i=this.settings.data;a<i.length;a++){var n=i[a];e.push(this.valueToData(n))}this.data=e,this.updateData()}else this.data=[]},e.prototype.unbindEvent=function(){t.prototype.unbindEvent.call(this),this.$dataContainer.off("click",".close-icon")},e.prototype.updateData=function(){for(var t="",e=0,a=this.data;e<a.length;e++){var i=a[e];t+=this.createData(i)}this.$dataContainer.html(t)},e.defaultSettings={repeatable:!1},e}(component_1.PdComponent);exports.PdVisTagEditor=PdVisTagEditor;