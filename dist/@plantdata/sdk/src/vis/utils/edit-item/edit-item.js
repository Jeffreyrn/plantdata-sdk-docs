"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var $=require("jquery"),lodash_1=require("lodash"),checkbox_1=require("../../../ui/components/checkbox/checkbox"),radio_1=require("../../../ui/components/radio/radio"),input_1=require("../../../ui/components/input/input"),switch_1=require("../../../ui/components/switch/switch"),textarea_1=require("../../../ui/components/textarea/textarea"),form_1=require("../../../ui/components/form/form"),common_1=require("../../../common/common"),settings_1=require("../../../icon/settings"),delete_1=require("../../../icon/delete"),arrow_right_1=require("../../../icon/arrow-right"),PdVisEditItem=function(){function e(){}return e.checkValueItemRequired=function(t){var a=t.find("[name]").val();return e.updateEditItemStatus(t,!!a),!!a},e.clearEditItemStatus=function(e){e.removeClass("error success")},e.createCheckbox=function(t){return e.createCheckboxOrRadio(t,"checkbox")},e.createEditor=function(t,a,i){void 0===t&&(t={}),void 0===i&&(i=a);var l={mode:"label",inputType:"text"},d="";if((!a||lodash_1.indexOf(a,"key")>=0)&&(d+=e.gentEditItem($.extend(!0,{},l,{value:t.key,key:"key",label:"字段名",type:"input"}))),(!a||lodash_1.indexOf(a,"label")>=0)&&(d+=e.gentEditItem($.extend(!0,{},l,{value:t.label,key:"label",label:"显示名称",type:"input"}))),(!a||lodash_1.indexOf(a,"mode")>=0)&&(d+=e.gentEditItem($.extend(!0,{},l,{value:t.mode,key:"mode",label:"显示模式",type:"select",options:{label:"Label形式",placeholder:"Placeholder形式"}}))),(!a||lodash_1.indexOf(a,"placeholder")>=0)&&(d+=e.gentEditItem($.extend(!0,{},l,{value:t.placeholder,key:"placeholder",label:"Placeholder",type:"input"}))),!a||lodash_1.indexOf(a,"type")>=0){var r={checkbox:"多选框",date:"日期",dateRange:"日期范围",datetime:"日期时间",datetimeRange:"日期时间范围",input:"文本",radio:"单选框",select:"下拉框","switch":"开关",group:"组合"};d+=e.gentEditItem($.extend(!0,{},l,{value:t.type,key:"type",label:"类型",type:"select",options:lodash_1.pick(r,["date","dateRange","datetime","datetimeRange","input","select","switch","group"])}))}if((!a||lodash_1.indexOf(a,"value")>=0)&&(d+=e.gentEditItem($.extend(!0,{},l,{value:t.value,key:"value",label:"默认值",type:"input"}))),!a||lodash_1.indexOf(a,"options")>=0){var n={key:"options",label:"可选项",type:"group",children:[$.extend(!0,{},l,{key:"key",label:"实际值",type:"input"}),$.extend(!0,{},l,{key:"label",label:"存储值",type:"input"})]};d+=e.gentEditItem($.extend(!0,{},l,n))}if((!a||lodash_1.indexOf(a,"inputType")>=0)&&(d+=e.gentEditItem($.extend(!0,{},l,{value:t.inputType,key:"inputType",label:"输入类型",type:"select",options:{text:"文本类型",number:"数字类型"}}))),(!a||lodash_1.indexOf(a,"required")>=0)&&(d+=e.gentEditItem($.extend(!0,{},l,{value:t.required,key:"required",label:"是否必填",type:"switch",options:["是","否"]}))),(!a||lodash_1.indexOf(a,"editable")>=0)&&(d+=e.gentEditItem($.extend(!0,{},l,{value:t.editable,key:"editable",label:"是否可编辑",type:"switch",options:["是","否"]}))),(!a||lodash_1.indexOf(a,"disabled")>=0)&&(d+=e.gentEditItem($.extend(!0,{},l,{value:t.disabled,key:"disabled",label:"是否禁用",type:"switch",options:["是","否"]}))),(!a||lodash_1.indexOf(a,"deletable")>=0)&&(d+=e.gentEditItem($.extend(!0,{},l,{value:t.deletable,key:"deletable",label:"谁否可删除",type:"switch",options:["是","否"]}))),("group"===t.type&&!a||lodash_1.indexOf(a,"children")>=0)&&t.children&&t.children.length)for(var o=0,c=t.children;o<c.length;o++){var s=c[o];d+=e.createEditor(s,i)}return'<fieldset class="pdvis-edit-item-editor">'+d+"</fieldset>"},e.createGroup=function(t,a){void 0===a&&(a="");for(var i='<fieldset class="pd-form-body pdui-form-fieldset" name="'+t.key+'">',l=0,d=t.children;l<d.length;l++){var r=d[l];r.mode=r.mode||t.mode,i+=e.gentEditItem(r,a)}return i+"</fieldset>"},e.createInput=function(e){var t={html:e.label,size:"sm",atts:{placeholder:e.placeholder,disabled:e.disabled,type:e.inputType,value:e.value,name:e.key,autocomplete:"off"}};return input_1.PdUIInput.create(t)},e.createRadio=function(t){return e.createCheckboxOrRadio(t,"radio")},e.createSelect=function(e){var t="";e.placeholder&&(t='placeholder="'+e.placeholder+'"');for(var a='<select class="pdvis-edit-item-select '+(e["class"]||"")+'" name="'+e.key+'" '+t+">",i=common_1.PdCommonUtils.transferOption(e.options),l=0,d=0,r=i;d<r.length;d++){var n=r[d],o="";n.checked&&(o=' selected="true"'),a+='<option value="'+n.value+'" '+o+">"+n.label+"</option>",l++}return a+="</select>"},e.createSwitch=function(e){var t;return switch_1.PdUISwitch.create({label:e.options,size:"md",input:{atts:(t={disabled:e.disabled,checked:e.value,name:e.key},t[form_1.PdUIForm.attrSwitch]=!0,t)}})},e.createTextarea=function(e){var t={html:e.value,size:"sm",atts:{placeholder:e.placeholder,disabled:e.disabled,name:e.key,autocomplete:"off"}};return textarea_1.PdUITextarea.create(t)},e.createEditItem=function(e,t){switch(void 0===t&&(t=""),e.value=e.value||e.selected,e.type){case"label":return"";case"checkbox":return this.createCheckbox(e);case"radio":return this.createRadio(e);case"select":return this.createSelect(e);case"input":return this.createInput(e);case"textarea":return this.createTextarea(e);case"switch":return this.createSwitch(e);case"group":return this.createGroup(e,t);case"datetime":case"datetimeRange":case"date":case"dateRange":return this.createInput(e);default:return"暂未支持的类型"}},e.buildEditItem=function(e,t,a,i){return void 0===i&&(i=""),'<div class="pdvis-edit-item '+a+'" data-path="'+i+'"><div class="pdvis-edit-item-title">'+e+'</div><div class="pdvis-edit-item-content">'+t+"</div></div>"},e.gentEditItem=function(t,a){void 0===a&&(a=""),t=$.extend(!0,{},t);var i="";if(t.type||(t.type=t.selected instanceof Array?"checkbox":"radio"),"checkbox"===t.type){var l=common_1.PdCommonUtils.createId(t.key+"-");i=checkbox_1.PdUICheckbox.create({html:"全选",cls:"pdvis-edit-item-selected-all",input:{atts:{id:l}}})}var d="",r="";if(t.required&&(d+=" pdvis-edit-item-required"),a+=(a?".":"")+t.key.toString(),t.editable&&(d+=" pdvis-edit-item-editable",r='<span class="pdvis-edit-item-config">'+settings_1["default"](20)+"</span>"),"checkbox"===t.type||"radio"===t.type||"group"===t.type){var n="";t.deletable&&(d+=" pdvis-edit-item-deletable",n='<span class="pdvis-edit-item-remove">'+delete_1["default"](20)+"</span>");var o=t.label+n+r+i,c=e.createEditItem(t,a);return e.buildEditItem(o,c,d,a)}var s="";if("label"===t.mode){var u='<span class="pdvis-edit-item-label">'+t.label+"</span>";s='<label title="'+t.label+'">'+u+":</label>"}t.placeholder=t.placeholder||t.label,t.required&&(t.placeholder+="(必填)");var n="";t.deletable&&(d+=" pdvis-edit-item-deletable",n='<span class="pdvis-edit-item-remove">'+delete_1["default"](20)+"</span>"),t["class"]&&(d+=" "+t["class"]);var p=t.html||e.createEditItem(t,a),m=t.postfix?'<span class="pdvis-edit-item-postfix"\n                title="'+t.postfix+'">'+t.postfix+"</span>":"";return'<div class="pdvis-edit-item '+d+' pdvis-edit-item-single clearfix" data-path="'+a+'">'+s+p+n+r+m+"</div>"},e.updateEditItemStatus=function(e,t){e.toggleClass("error",!t),e.toggleClass("success",t)},e.createCheckboxOrRadio=function(t,a){var i=t.key,l=common_1.PdCommonUtils.transferOption(t.options,t.value);if(t.isTree)return e.createTree(l,i);if(l.length){for(var d=common_1.PdCommonUtils.createId(i+"-"),r='<div class="clearfix pdvis-cr-box">',n=0,o=0,c=l;o<c.length;o++){var s=c[o],u={html:s.label,atts:{title:s.label,"data-label":s.label},input:{atts:{id:d+n,value:s.value,name:i}}};s.checked&&(u.input.atts.checked=!0),r+="checkbox"===a?checkbox_1.PdUICheckbox.create(u):radio_1.PdUIRadio.create(u),n++}return r+"</div>"}return'<div class="pdvis-edit-no-option">无数据</div>'},e.createTree=function(t,a,i){void 0===i&&(i=0);for(var l=common_1.PdCommonUtils.createId(a+"-"),d='<ul class="clearfix pdvis-cr-box">',r=0,n=0,o=t;n<o.length;n++){var c=o[n],s=16*i+24+"px",u={html:c.label,atts:{title:c.label},input:{atts:{id:l+r,value:c.value,name:a}}};c.checked&&(u.input.atts.checked=!0);var p="",m="";c.children&&(p=e.createTree(c.children,a,i+1),m=arrow_right_1["default"]());var h=checkbox_1.PdUICheckbox.create(u),v='<div class="pdvis-cr-item" style="padding-left: '+s+';" title="'+c.label+'">'+m+h+"</div>";d+='<li class="pdvis-cr-child" data-option-path="'+c._path+'" data-label="'+c.label+'">'+v+p+"</li>",r++}return d+"</ul>"},e}();exports.PdVisEditItem=PdVisEditItem;