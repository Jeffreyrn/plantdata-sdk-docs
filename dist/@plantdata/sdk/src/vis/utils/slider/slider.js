"use strict";var __extends=this&&this.__extends||function(){var t=function(e,s){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s])})(e,s)};return function(e,s){function i(){this.constructor=e}t(e,s),e.prototype=null===s?Object.create(s):(i.prototype=s.prototype,new i)}}();Object.defineProperty(exports,"__esModule",{value:!0});var $=require("jquery"),lodash_1=require("lodash"),component_1=require("../../../core/component"),common_1=require("../../../common/common"),tooltip_1=require("../../../ui/components/tooltip/tooltip"),PdVisSlider=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.setValue=function(t){this.settings.value=t,this.updateUI()},e.prototype.getValue=function(){return this.settings.value},e.prototype.bindEvent=function(){var e=this;t.prototype.bindEvent.call(this),this.$el.on("click",".pdvis-slider-runway:not(.disabled)",function(t){var s=lodash_1.cloneDeep(e.settings.value);e.updateValueByPos(t[e.pageDirection]),e.updateUI(),e.settings.change&&!lodash_1.isEqual(s,e.settings.value)&&e.settings.change(e.settings.value)}),this.$el.on("mousedown",".pdvis-slider-runway:not(.disabled) .pdvis-slider-button-wrapper",function(t){var s=0;if(e.settings.range){var i=e.getValueByElement(t.currentTarget);s=e.getNearNumber(i)===e.settings.value[1]?1:0}var n=lodash_1.cloneDeep(e.settings.value);e.upHandler&&$(document).off("mousemove.drag",e.moveHandler),e.moveHandler&&$(document).off("mouseup",e.upHandler),e.moveHandler=lodash_1.debounce(function(t){var i=lodash_1.cloneDeep(e.settings.value);if(e.settings.range){var n=e.posToValue(t[e.pageDirection]);0!==s&&1!==s&&(s=e.getNearNumber(n)===i[0]?0:1),i[s]=n,i[1]<i[0]?(e.settings.value=[i[1],i[0]],s=0===s?1:0):e.settings.value=i}else e.updateValueByPos(t[e.pageDirection]);e.settings.dragging&&!lodash_1.isEqual(i,e.settings.value)&&e.settings.dragging(e.settings.value),e.updateUI()},e.settings.debounceTime),e.upHandler=function(t){$(document).off("mousemove.drag",e.moveHandler).off("mouseup",e.upHandler),e.upHandler=null,e.moveHandler=null,e.settings.change&&!lodash_1.isEqual(n,e.settings.value)&&e.settings.change(e.settings.value)},$(document).on("mousemove.drag",e.moveHandler).on("mouseup",e.upHandler)}).on("mousedown",".pdvis-slider-runway:not(.disabled) .pdvis-slider-bar",function(t){if(e.settings.range){var s=lodash_1.cloneDeep(e.settings.value),i=e.posToValue(t[e.pageDirection]),n=e.settings.value[1]-e.settings.value[0];e.upHandler&&$(document).off("mousemove.drag",e.moveHandler),e.moveHandler&&$(document).off("mouseup",e.upHandler),e.moveHandler=lodash_1.debounce(function(t){var o=lodash_1.cloneDeep(e.settings.value),a=e.posToValue(t[e.pageDirection]),r=a-i,l=s[0]+r,u=s[1]+r;l<e.settings.min?(l=e.settings.min,u=l+n):u>e.settings.max&&(u=e.settings.max,l=u-n),e.settings.value[0]=e.getDecimalNumber(l),e.settings.value[1]=e.getDecimalNumber(u),e.settings.dragging&&!lodash_1.isEqual(o,e.settings.value)&&e.settings.dragging(e.settings.value),e.updateUI()},e.settings.debounceTime),e.upHandler=function(t){$(document).off("mousemove.drag",e.moveHandler).off("mouseup",e.upHandler),e.upHandler=null,e.moveHandler=null,e.settings.change&&!lodash_1.isEqual(s,e.settings.value)&&e.settings.change(e.settings.value)},$(document).on("mousemove.drag",e.moveHandler).on("mouseup",e.upHandler)}}).on("click",".pdvis-slider-button-wrapper",function(t){t.stopPropagation()}).on("click",".pdvis-slider-bar",function(t){t.stopPropagation()})},e.prototype.getDecimalNumber=function(t){var e,s=this.settings.step.toString();return s.indexOf(".")!==-1&&(e=s.substring(2).length),t=Number(t.toFixed(e))},e.prototype.getNearNumber=function(t){var e=lodash_1.cloneDeep(this.settings.value);return e.sort(function(e,s){return Math.abs(e-t)-Math.abs(s-t)})[0]},e.prototype.getSimilarNumber=function(t){for(var e=this.settings.min,s=this.settings.step,i=0;t>s;)t-=s,i++;return t=t>=s/2?(i+1)*s:i*s,t+=e},e.prototype.getValueByElement=function(t){return parseFloat($(t).attr(tooltip_1.PdUITooltip.attrTitle))},e.prototype.initTemplate=function(){var t=this,e=$(this.settings.selector);e.addClass("pdvis-slider"),this.settings.disabled&&e.addClass("disabled"),this.settings.vertical?(e.addClass("is-vertical"),e.height(this.settings.height),this.tooltipPosition="left"):this.tooltipPosition="top";var s=function(e){var s=common_1.PdCommonUtils.createId("tooltip-"),i=['id="'+s+'"',tooltip_1.PdUITooltip.attrName,tooltip_1.PdUITooltip.attrHideDelay+'="-1"',tooltip_1.PdUITooltip.attrPosition+'="'+t.tooltipPosition+'"',tooltip_1.PdUITooltip.attrContainer+'="#'+s+'"'],n=i.join(" ");return'<div class="pdvis-slider-button-wrapper" '+n+' title="'+e+'">\n                        <div class="pdvis-slider-button pdvis-slider-tooltip"></div>\n                    </div>'},i=function(t,e){var i="";return i+=t?s(e[0])+s(e[1]):s(e),'<div class="pdvis-slider-runway"><div class="pdvis-slider-bar"></div>'+i+"</div>"};return e.html('<span class="pdvis-slider-label">'+this.settings.min+"</span>"+i(this.settings.range,this.settings.value)+'<span class="pdvis-slider-label">'+this.settings.max+"</span>"),e.toggleClass("pdvis-show-label",this.settings.showLabel)},e.prototype.initSettings=function(s){return $.extend(!0,{},t.prototype.initSettings.call(this,e.defaultSettings),s)},e.prototype.mounted=function(){t.prototype.mounted.call(this),this.settings.vertical?(this.direction="bottom",this.wh="height",this.offset="offsetY",this.pageDirection="pageY"):(this.direction="left",this.wh="width",this.offset="offsetX",this.pageDirection="pageX"),this.settings.range&&(this.settings.value=this.settings.value||[this.settings.min,this.settings.max]),this.updateUI(),this.bindEvent()},e.prototype.posToValue=function(t){var e=this.select(".pdvis-slider-runway");if(e.length){var s=e.offset(),i=s.left;this.settings.vertical&&(i=s.top);var n=e[this.wh](),o=t-i;this.settings.vertical&&(o=n-o);var a=this.settings.max,r=this.settings.min,l=this.getSimilarNumber(o/n*(a-r)),u=this.getDecimalNumber(l);return u<r?u=r:u>a&&(u=a),u}return $(document).off("mousemove.drag",this.moveHandler).off("mouseup",this.upHandler),0},e.prototype.updateUI=function(){var t=(this.settings.max-this.settings.min)/100,e=this.select(".pdvis-slider-bar");if(this.settings.range){var s=this.select(".pdvis-slider-button-wrapper:eq(0)"),i=this.select(".pdvis-slider-button-wrapper:eq(1)"),n=(this.settings.value[0]-this.settings.min)/t+"%",o=(this.settings.value[1]-this.settings.min)/t+"%";s.css(this.direction,n),i.css(this.direction,o),e[this.wh]((this.settings.value[1]-this.settings.value[0])/t+"%"),e.css(this.direction,n),this.settings.showTooltip!==!1&&(s.attr("title",this.settings.value[0]),i.attr("title",this.settings.value[1]),tooltip_1.PdUITooltip.updateTooltip(s),tooltip_1.PdUITooltip.updateTooltip(i))}else{var a=this.settings.value,r=(a-this.settings.min)/t+"%",l=this.select(".pdvis-slider-button-wrapper");l.css(this.direction,r),e[this.wh](r),this.settings.showTooltip!==!1&&(l.attr("title",a),tooltip_1.PdUITooltip.updateTooltip(l))}},e.prototype.unbindEvent=function(){t.prototype.unbindEvent.call(this),this.$el.off("click",".pdvis-slider-runway:not(.disabled)"),this.$el.off("mousedown",".pdvis-slider-runway:not(.disabled) .pdvis-slider-button-wrapper").off("click",".pdvis-slider-button-wrapper")},e.prototype.updateValueByPos=function(t){var e=this.posToValue(t);this.settings.range?this.getNearNumber(e)===this.settings.value[0]?this.settings.value[0]=e:this.settings.value[1]=e:this.settings.value=e},e.defaultSettings={value:0,debounceTime:0,showTooltip:!0,showLabel:!1,max:100,min:0,step:1},e}(component_1.PdComponent);exports.PdVisSlider=PdVisSlider;