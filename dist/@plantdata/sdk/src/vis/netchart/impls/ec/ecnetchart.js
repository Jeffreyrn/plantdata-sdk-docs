"use strict";var __extends=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}();Object.defineProperty(exports,"__esModule",{value:!0});var $=require("jquery"),echarts=require("echarts"),lodash_1=require("lodash"),netchart_1=require("../../netchart"),common_1=require("../../../../common"),PdVisEcNetChart=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.resetLayout=function(){common_1.PdCommonUtils.error("未实现")},e.prototype.resize=function(){this.chart.resize()},e.prototype.updateChart=function(){this.updateData(),this.dispatch("styleupdate",this.eventData),this.dispatch("chartupdate",this.eventData)},e.prototype.updateData=function(){var t=this.getSettings(),e=this.getData();t.series[0].data=this.updateNodes(e.nodes),t.series[0].links=this.updateLinks(e.links),this.chart.setOption(t),this.dispatch("dataupdate",this.eventData)},e.prototype.updateStyle=function(){this.chart.setOption(this.getSettings()),this.dispatch("styleupdate",this.eventData)},e.prototype.getSettings=function(){var t=this.chart.getOption();return t||(t=lodash_1.cloneDeep(this.settings.main.settings)),t},e.prototype.initChart=function(){var t=this;this.chart=echarts.init(this.$mainContainer[0]);var e=this.settings.main.events;this.chart.on("dblclick",function(n){e.nodeDblClick?e.nodeDblClick(n.data,n):"node"===n.dataType&&t.nodeDblClick(n.data)}),e.nodeClick&&this.chart.on("click",function(t){e.nodeClick(t.data,t)}),e.nodeRightClick&&(document.oncontextmenu=function(){return"node"===t.rightClickType?(t.rightClickType=null,!1):void(t.rightClickType=null)},this.chart.on("contextmenu",function(n){switch(n.dataType){case"node":t.rightClickType="node",e.nodeRightClick(n.data,n);break;case"edge":t.rightClickType="link";break;default:t.rightClickType="canvas"}}))},e.prototype.initSettings=function(n){var i=this,o=$.extend(!0,{},t.prototype.initSettings.call(this,e.defaultSettings),n),a=netchart_1.PdVisNetChart.nodeColor;try{a=o.main.settings.series[0].itemStyle.color}catch(r){}o.main.settings.series[0].itemStyle.color=function(t){var e=i.nodeColorFunction(t.data);return e?e:a instanceof Function?a(t):a};var s=netchart_1.PdVisNetChart.normalRadius;try{s=o.main.settings.series[0].symbolSize}catch(r){}return o.main.settings.series[0].symbolSize=function(t,e){var n=i.nodeRadiusFunction(e.data);return n?n:s instanceof Function?s(e):s},o},e.prototype.updateLinks=function(t){var e=lodash_1.cloneDeep(this.settings.main.linkSettings);return lodash_1.flatMap(t,function(t){return t.source=t.from,t.target=t.to,$.extend(!0,{},e,t)})},e.prototype.updateNodes=function(t){var e=lodash_1.cloneDeep(this.settings.main.nodeSettings);return lodash_1.flatMap(t,function(t){return $.extend(!0,{},e,t)})},e.defaultSettings={main:{settings:{animation:!1,tooltip:{},series:[{type:"graph",layout:"force",roam:!0,legendHoverLink:!0,hoverAnimation:!0,force:{repulsion:300,edgeLength:[50,300]},draggable:!0,symbolSize:netchart_1.PdVisNetChart.normalRadius,edgeSymbol:["none","arrow"],edgeSymbolSize:netchart_1.PdVisNetChart.normalRadius/4,focusNodeAdjacency:!1,tooltip:{formatter:function(t,e,n){return t.data.name||t.data.attName}},itemStyle:{color:netchart_1.PdVisNetChart.nodeColor},lineStyle:{color:netchart_1.PdVisNetChart.linkColor,curveness:0},label:{show:!0,color:"#333",position:"bottom"},edgeLabel:{show:!1},emphasis:{itemStyle:{},edgeLabel:{show:!0}}}]},events:{},nodeSettings:{},linkSettings:{}}},e}(netchart_1.PdVisNetChart);exports.PdVisEcNetChart=PdVisEcNetChart;